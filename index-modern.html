<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Family Cheese - –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —Å–∏—Ä–∏</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
:root {
    /* –°—É—á–∞—Å–Ω–∞ –ø–∞–ª—ñ—Ç—Ä–∞ –∫–æ–ª—å–æ—Ä—ñ–≤ */
    --primary: #FF6B35;
    --primary-dark: #E85A2B;
    --primary-light: #FF8C5A;
    --accent: #FFD93D;
    --success: #6BCB77;
    --error: #FF6B6B;
    
    /* –§–æ–Ω —Ç–∞ –ø–æ–≤–µ—Ä—Ö–Ω—ñ */
    --bg-primary: #0A0E27;
    --bg-secondary: #141B2D;
    --bg-card: rgba(255, 255, 255, 0.05);
    --bg-glass: rgba(255, 255, 255, 0.08);
    --bg-hover: rgba(255, 255, 255, 0.12);
    
    /* –¢–µ–∫—Å—Ç */
    --text-primary: #FFFFFF;
    --text-secondary: rgba(255, 255, 255, 0.7);
    --text-muted: rgba(255, 255, 255, 0.5);
    
    /* –ì—Ä–∞–¥—ñ—î–Ω—Ç–∏ */
    --gradient-primary: linear-gradient(135deg, #FF6B35 0%, #FF8C5A 100%);
    --gradient-accent: linear-gradient(135deg, #FFD93D 0%, #FF6B35 100%);
    --gradient-card: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 140, 90, 0.05) 100%);
    
    /* –¢—ñ–Ω—ñ */
    --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.1);
    --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.15);
    --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.2);
    --shadow-glow: 0 0 20px rgba(255, 107, 53, 0.3);
    
    /* Border */
    --border-color: rgba(255, 255, 255, 0.1);
    --border-radius: 20px;
    --border-radius-sm: 12px;
    --border-radius-lg: 28px;
    
    /* Spacing */
    --spacing-xs: 0.5rem;
    --spacing-sm: 1rem;
    --spacing-md: 1.5rem;
    --spacing-lg: 2rem;
    --spacing-xl: 3rem;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary);
    background-image: 
        radial-gradient(at 0% 0%, rgba(255, 107, 53, 0.1) 0px, transparent 50%),
        radial-gradient(at 100% 100%, rgba(255, 217, 61, 0.1) 0px, transparent 50%);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
    min-height: 100vh;
}

/* HEADER - Glassmorphism */
.header {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: rgba(10, 14, 39, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-bottom: 1px solid var(--border-color);
    padding: var(--spacing-sm) 0;
}

.header-content {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: 0 var(--spacing-md);
    max-width: 1400px;
    margin: 0 auto;
}

.logo {
    font-family: 'Playfair Display', serif;
    font-size: 1.75rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    white-space: nowrap;
    letter-spacing: -0.5px;
}

.search-container {
    flex-grow: 1;
    position: relative;
    max-width: 600px;
}

.search-input {
    width: 100%;
    padding: 0.875rem 1.25rem 0.875rem 3rem;
    border: 1.5px solid var(--border-color);
    border-radius: var(--border-radius-lg);
    font-size: 0.95rem;
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    color: var(--text-primary);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.search-input::placeholder {
    color: var(--text-muted);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--bg-hover);
    box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.1), var(--shadow-md);
    transform: translateY(-1px);
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    font-size: 1rem;
    pointer-events: none;
    transition: color 0.3s ease;
}

.search-input:focus + .search-icon {
    color: var(--primary);
}

.cart-badge {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: none;
    background: var(--gradient-primary);
    color: white;
    font-size: 1.3rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: var(--shadow-md), var(--shadow-glow);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.cart-badge:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: var(--shadow-lg), 0 0 30px rgba(255, 107, 53, 0.4);
}

.cart-badge:active {
    transform: translateY(0) scale(0.98);
}

.cart-count {
    position: absolute;
    top: -6px;
    right: -6px;
    background: var(--error);
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
    border: 3px solid var(--bg-primary);
    box-shadow: var(--shadow-sm);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.cart-count.hidden {
    display: none;
}

/* PROMO - –°—É—á–∞—Å–Ω–∏–π –±–∞–Ω–µ—Ä */
.promo-section {
    padding: var(--spacing-md);
    margin-top: -0.5rem;
}

.promo-box {
    background: var(--gradient-accent);
    color: var(--bg-primary);
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--border-radius);
    text-align: center;
    position: relative;
    box-shadow: var(--shadow-lg), 0 0 40px rgba(255, 217, 61, 0.3);
    font-weight: 600;
    font-size: 1rem;
    line-height: 1.6;
    overflow: hidden;
}

.promo-box::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    animation: shine 3s infinite;
}

@keyframes shine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.promo-box strong {
    font-size: 1.2rem;
    display: block;
    margin: 0.4rem 0;
    font-weight: 800;
}

.promo-close {
    position: absolute;
    top: 0.75rem;
    right: 0.75rem;
    background: rgba(0, 0, 0, 0.1);
    border: none;
    color: var(--bg-primary);
    font-size: 1.2rem;
    cursor: pointer;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.promo-close:hover {
    background: rgba(0, 0, 0, 0.2);
    transform: rotate(90deg);
}

/* CONTAINER */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 var(--spacing-md) var(--spacing-xl);
}

.loading {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 300px;
    gap: var(--spacing-md);
    color: var(--text-secondary);
    font-weight: 500;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--border-color);
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* PRODUCT LIST - –°—É—á–∞—Å–Ω–∞ —Å—ñ—Ç–∫–∞ */
.product-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--spacing-lg);
    margin-top: var(--spacing-lg);
}

.product-card {
    background: var(--bg-card);
    backdrop-filter: blur(20px);
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    position: relative;
}

.product-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease;
}

.product-card:hover::before {
    transform: scaleX(1);
}

.product-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg), var(--shadow-glow);
    border-color: rgba(255, 107, 53, 0.3);
    background: var(--bg-hover);
}

.product-card:active {
    transform: translateY(-4px) scale(0.98);
}

.gallery-image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    background: var(--bg-secondary);
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.product-card:hover .gallery-image {
    transform: scale(1.05);
}

.product-info {
    padding: var(--spacing-md);
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
    line-height: 1.4;
    color: var(--text-primary);
}

.weight {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: var(--spacing-sm);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.price-container {
    display: flex;
    align-items: baseline;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
    margin-top: auto;
}

.current-price {
    font-size: 1.5rem;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.original-price {
    font-size: 0.9rem;
    color: var(--text-muted);
    text-decoration: line-through;
}

.card-footer {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.add-to-cart-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    background: var(--gradient-primary);
    color: white;
    font-size: 1.3rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    flex-shrink: 0;
}

.add-to-cart-btn:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: var(--shadow-lg), var(--shadow-glow);
}

.add-to-cart-btn:active {
    transform: scale(0.95);
}

.quantity-control {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    border-radius: var(--border-radius-lg);
    padding: 0.5rem;
    flex-shrink: 0;
    border: 1px solid var(--border-color);
}

.quantity-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    background: var(--gradient-primary);
    color: white;
    font-weight: 700;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    box-shadow: var(--shadow-sm);
}

.quantity-btn:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-md);
}

.quantity-btn:active {
    transform: scale(0.9);
}

.quantity {
    font-weight: 700;
    min-width: 24px;
    text-align: center;
    font-size: 1rem;
    color: var(--text-primary);
}

.details-btn {
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    color: var(--primary);
    cursor: pointer;
    font-size: 0.85rem;
    text-decoration: none;
    font-weight: 600;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-sm);
    transition: all 0.3s ease;
    margin-left: auto;
}

.details-btn:hover {
    background: var(--bg-hover);
    border-color: var(--primary);
    transform: translateX(4px);
}

/* ORDER FORM - –°—É—á–∞—Å–Ω–∏–π –º–æ–¥–∞–ª—å–Ω–∏–π –¥–∏–∑–∞–π–Ω */
.order-form {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-secondary);
    backdrop-filter: blur(30px);
    border-top-left-radius: var(--border-radius-lg);
    border-top-right-radius: var(--border-radius-lg);
    max-height: 92vh;
    overflow-y: auto;
    z-index: 1500;
    transform: translateY(100%);
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 -8px 40px rgba(0, 0, 0, 0.3);
    border-top: 3px solid var(--primary);
}

.order-form.visible {
    transform: translateY(0);
}

.order-form-content {
    padding: var(--spacing-xl) var(--spacing-lg);
    position: relative;
}

.order-form h2 {
    font-family: 'Playfair Display', serif;
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: var(--spacing-lg);
    color: var(--text-primary);
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.order-form-close-btn {
    position: absolute;
    top: var(--spacing-lg);
    right: var(--spacing-lg);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    color: var(--text-primary);
    font-size: 1.3rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: var(--shadow-md);
    z-index: 10;
    border: 1px solid var(--border-color);
}

.order-form-close-btn:hover {
    background: var(--error);
    color: white;
    transform: rotate(90deg) scale(1.1);
}

.change-order-btn {
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 1rem var(--spacing-md);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    margin-bottom: var(--spacing-lg);
    transition: all 0.3s ease;
    font-weight: 600;
    font-size: 0.95rem;
    width: 100%;
}

.test-send-btn {
    background: transparent;
    border: 1.5px dashed var(--border-color);
    color: var(--text-secondary);
    padding: 0.8rem var(--spacing-md);
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    width: 100%;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    margin-bottom: var(--spacing-lg);
}

.test-send-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgba(255, 217, 61, 0.08);
}

.change-order-btn:hover {
    background: var(--bg-hover);
    border-color: var(--primary);
    transform: translateY(-2px);
}

.summary-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    border-radius: var(--border-radius-sm);
    margin-bottom: var(--spacing-sm);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.summary-item:hover {
    background: var(--bg-hover);
    transform: translateX(4px);
}

.summary-item-img {
    width: 64px;
    height: 64px;
    border-radius: var(--border-radius-sm);
    object-fit: cover;
    box-shadow: var(--shadow-md);
}

.summary-item-details {
    flex: 1;
}

.summary-item-name {
    font-weight: 600;
    margin-bottom: 0.3rem;
    font-size: 0.95rem;
}

.summary-item-quantity {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

.summary-item-price {
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 1.1rem;
}

.summary-totals {
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    border-radius: var(--border-radius);
    padding: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
    border: 1px solid var(--border-color);
}

.summary-totals > div {
    display: flex;
    justify-content: space-between;
    margin-bottom: var(--spacing-sm);
    font-size: 1rem;
}

.total-price {
    font-weight: 700;
    font-size: 1.4rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    border-top: 2px solid var(--border-color);
    padding-top: var(--spacing-md);
    margin-top: var(--spacing-md);
}

.total-discount {
    color: var(--success);
    font-weight: 600;
}

.delivery-options {
    margin-bottom: var(--spacing-lg);
}

.delivery-options h2 {
    font-size: 1.2rem;
    margin-bottom: var(--spacing-md);
    font-weight: 600;
}

.delivery-option {
    display: flex;
    align-items: center;
    padding: var(--spacing-md);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    margin-bottom: var(--spacing-sm);
    cursor: pointer;
    transition: all 0.3s ease;
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
}

.delivery-option:hover {
    border-color: var(--primary);
    background: var(--bg-hover);
    transform: translateX(4px);
}

.delivery-option input[type="radio"]:checked + label {
    color: var(--primary);
}

.delivery-option input[type="radio"] {
    margin-right: var(--spacing-md);
    transform: scale(1.3);
    accent-color: var(--primary);
    cursor: pointer;
}

.delivery-option label {
    flex: 1;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
}

.delivery-option label b {
    display: block;
    margin-bottom: 0.3rem;
}

.delivery-option .price {
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.address-field {
    margin-bottom: var(--spacing-lg);
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: all 0.4s ease;
}

.address-field.visible {
    opacity: 1;
    max-height: 100px;
}

.form-group {
    margin-bottom: var(--spacing-md);
}

.form-group input,
.address-field input {
    width: 100%;
    padding: 1rem var(--spacing-md);
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    font-size: 1rem;
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
    color: var(--text-primary);
    transition: all 0.3s ease;
    font-family: 'Inter', sans-serif;
}

.form-group input::placeholder,
.address-field input::placeholder {
    color: var(--text-muted);
}

.form-group input:focus,
.address-field input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.1);
    background: var(--bg-hover);
    transform: translateY(-2px);
}

.error {
    color: var(--error);
    font-size: 0.95rem;
    margin-bottom: var(--spacing-md);
    text-align: center;
    font-weight: 500;
    padding: var(--spacing-sm);
    background: rgba(255, 107, 107, 0.1);
    border-radius: var(--border-radius-sm);
    border: 1px solid rgba(255, 107, 107, 0.3);
}

.order-notice {
    background: rgba(107, 203, 119, 0.1);
    border: 1.5px solid rgba(107, 203, 119, 0.3);
    border-radius: var(--border-radius-sm);
    padding: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    color: var(--success);
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.order-notice i {
    color: var(--success);
    font-size: 1.2rem;
    flex-shrink: 0;
}

/* MODAL */
.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    padding: var(--spacing-md);
}

.modal-backdrop.visible {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: var(--bg-secondary);
    backdrop-filter: blur(30px);
    border-radius: var(--border-radius-lg);
    max-width: 600px;
    width: 100%;
    max-height: 85vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg), 0 0 60px rgba(255, 107, 53, 0.2);
    transform: scale(0.9);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--border-color);
}

.modal-backdrop.visible .modal-content {
    transform: scale(1);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-glass);
    backdrop-filter: blur(10px);
}

.modal-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
}

.modal-close {
    background: var(--bg-glass);
    border: 1px solid var(--border-color);
    font-size: 1.3rem;
    cursor: pointer;
    color: var(--text-secondary);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: var(--error);
    color: white;
    transform: rotate(90deg);
    border-color: var(--error);
}

.modal-body {
    padding: var(--spacing-lg);
    line-height: 1.8;
    color: var(--text-secondary);
    font-size: 1rem;
}

/* INFO SECTIONS */
.info-section {
    padding: var(--spacing-xl) 0;
    margin-top: var(--spacing-xl);
}

.section-title {
    text-align: center;
    font-family: 'Playfair Display', serif;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: var(--spacing-xl);
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.about-content {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-xl);
    text-align: center;
}

.about-image img {
    width: 100%;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-lg);
}

.about-text h3 {
    font-family: 'Playfair Display', serif;
    font-size: 1.75rem;
    margin-bottom: var(--spacing-md);
    font-weight: 600;
}

.about-text p {
    color: var(--text-secondary);
    line-height: 1.8;
    font-size: 1.05rem;
}

.reviews-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-md);
}

.review-card {
    background: var(--bg-card);
    backdrop-filter: blur(20px);
    padding: var(--spacing-lg);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
}

.review-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    background: var(--bg-hover);
}

.review-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}

.review-header .fa-user-circle {
    font-size: 3rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    flex-shrink: 0;
}

.reviewer-name {
    font-weight: 600;
    font-size: 1rem;
}

.review-stars {
    color: var(--accent);
    font-size: 1rem;
}

.review-text {
    color: var(--text-secondary);
    font-style: italic;
    font-size: 0.95rem;
    line-height: 1.7;
}

/* RESPONSIVE */
@media (min-width: 600px) {
    .reviews-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 768px) {
    .header {
        padding: var(--spacing-md) 0;
    }
    
    .header-content {
        gap: var(--spacing-lg);
        padding: 0 var(--spacing-lg);
    }

    .search-input {
        padding: 1rem 1.5rem 1rem 3.5rem;
    }

    .container {
        padding: 0 var(--spacing-lg) var(--spacing-xl);
    }

    .product-list {
        gap: var(--spacing-xl);
        margin-top: var(--spacing-xl);
    }

    .section-title {
        font-size: 3rem;
    }

    .about-content {
        grid-template-columns: 1fr 1.5fr;
        text-align: left;
        gap: var(--spacing-xl);
    }
}

@media (min-width: 1024px) {
    .product-list {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: var(--spacing-xl);
    }

    .reviews-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

.hidden {
    display: none !important;
}

/* Scrollbar —Å—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: var(--bg-secondary);
}

::-webkit-scrollbar-thumb {
    background: var(--gradient-primary);
    border-radius: 5px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--primary-dark);
}
</style>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <header class="header">
    <div class="header-content">
        <div class="logo">üßÄ Family Cheese</div>
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="–ü–æ—à—É–∫ —Å–∏—Ä—ñ–≤..." id="search-input">
        </div>
        <button class="cart-badge" id="cart-badge" title="–ö–æ—à–∏–∫">
            <span class="cart-count hidden" id="cart-count">0</span>
            <i class="fas fa-shopping-cart"></i>
        </button>
    </div>
</header>

<section class="promo-section" id="promo-section">
  <div class="container">
    <div class="promo-box">
      üéâ <strong>15% –Ω–∞ –≤—Å—ñ —Å–∏—Ä–∏</strong>
      + –¥–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –û–±—É—Ö–æ–≤—É <strong>1 –≥—Ä–Ω</strong>
      <br><small style="opacity: 0.9;">–¢—ñ–ª—å–∫–∏ —Ü—å–æ–≥–æ —Ç–∏–∂–Ω—è!</small>
      <button class="promo-close" id="promo-close"><i class="fas fa-times"></i></button>
    </div>
  </div>
</section>

<div class="container">
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
    </div>
    <div class="product-list" id="product-list"></div>
</div>

<section id="reviews" class="info-section">
    <div class="container">
        <h2 class="section-title">–í—ñ–¥–≥—É–∫–∏ –∫–ª—ñ—î–Ω—Ç—ñ–≤</h2>
        <div class="reviews-grid">
            <div class="review-card">
                <div class="review-header">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <p class="reviewer-name">–û–ª–µ–Ω–∞ –ü.</p>
                        <div class="review-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    </div>
                </div>
                <p class="review-text">"–ù–µ–π–º–æ–≤—ñ—Ä–Ω–æ —Å–º–∞—á–Ω–∏–π —Å–∏—Ä! –ì–∞—É–¥–∞ –ø—Ä–æ—Å—Ç–æ —Ç–∞–Ω–µ –≤ —Ä–æ—Ç—ñ. –í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ñ—Å—Ç—å. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –∑–∞–º–æ–≤–ª—é —â–µ!"</p>
            </div>
            <div class="review-card">
                <div class="review-header">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <p class="reviewer-name">–ê–Ω–¥—Ä—ñ–π</p>
                        <div class="review-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></div>
                    </div>
                </div>
                <p class="review-text">"–ó–∞–º–æ–≤–ª—è–≤ –ø–æ –û–±—É—Ö–æ–≤—É, –ø—Ä–∏–≤–µ–∑–ª–∏ —à–≤–∏–¥–∫–æ. –°–∏—Ä —Å–≤—ñ–∂–∏–π —ñ –∞—Ä–æ–º–∞—Ç–Ω–∏–π. –Ø–∫—ñ—Å—Ç—å —Ç–æ–≥–æ –≤–∞—Ä—Ç–∞!"</p>
            </div>
        </div>
    </div>
</section>

<section id="about-us" class="info-section">
    <div class="container">
        <h2 class="section-title">–ü—Ä–æ –ù–∞—Å</h2>
        <div class="about-content">
            <div class="about-image">
                <img src="data/pro_nas.png" alt="–ù–∞—à–∞ —Å–∏—Ä–æ–≤–∞—Ä–Ω—è" onerror="this.style.display='none'">
            </div>
            <div class="about-text">
                <h3>–°—ñ–º–µ–π–Ω–∞ —Å–ø—Ä–∞–≤–∞ –∑ –ª—é–±–æ–≤'—é</h3>
                <p><strong>Family Cheese</strong> –Ω–µ–≤–µ–ª–∏–∫–∞ —Å—ñ–º–µ–π–Ω–∞ —Å–∏—Ä–æ–≤–∞—Ä–Ω—è, –¥–µ —Å—Ç–≤–æ—Ä—é—é—Ç—å –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —Å–∏—Ä–∏ –∑–∞ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–º–∏ —Ä–µ—Ü–µ–ø—Ç–∞–º–∏. –ö–æ–∂–Ω–∞ –≥–æ–ª–æ–≤–∫–∞, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä—É—á–Ω–æ—ó –ø—Ä–∞—Ü—ñ, —è–∫—ñ—Å–Ω–æ–≥–æ –º–æ–ª–æ–∫–∞ —Ç–∞ –ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç—ñ –¥–æ —Å–∏—Ä–æ–≤–∞—Ä—ñ–Ω–Ω—è.</p>
            </div>
        </div>
    </div>
</section>

<div class="modal-backdrop" id="description-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-title"></h2>
            <button class="modal-close" id="modal-close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modal-body"></div>
    </div>
</div>

<div id="order-form" class="order-form">
    <div class="order-form-content">
        <h2>–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
        <button class="order-form-close-btn" id="order-form-close-btn" title="–ó–∞–∫—Ä–∏—Ç–∏"><i class="fas fa-times"></i></button>
        
        <div id="order-summary"></div>
        
        <div class="order-notice">
            <i class="fas fa-info-circle"></i>
            –ü—ñ—Å–ª—è –∑–≤–∞–∂—É–≤–∞–Ω–Ω—è —Å—É–º–∞ —Å—Ç–∞–Ω–µ –º–µ–Ω—à–æ—é!
        </div>

        <button class="change-order-btn"><i class="fas fa-edit"></i> –ó–º—ñ–Ω–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
        <button class="test-send-btn" id="test-send-btn" type="button">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ (sendData)</button>
        <button class="test-send-btn" id="test-send-btn"><i class="fas fa-paper-plane"></i> –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ Telegram</button>

        <div class="delivery-options">
            <h2>–°–ø–æ—Å—ñ–± –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
            <div class="delivery-option">
                <input type="radio" id="obukhiv-delivery" name="delivery" value="1" data-title="–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –º. –û–±—É—Ö—ñ–≤" checked>
                <label for="obukhiv-delivery"><b>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –º. –û–±—É—Ö—ñ–≤</b></label>
                <span class="price">1 –≥—Ä–Ω</span>
            </div>
            <div class="delivery-option">
                <input type="radio" id="obukhiv-nova-poshta" name="delivery" value="1" data-title="–î–æ—Å—Ç–∞–≤–∫–∞ –ù–æ–≤–∞ –ø–æ—à—Ç–∞ –º. –û–±—É—Ö—ñ–≤">
                <label for="obukhiv-nova-poshta"><b>–ù–æ–≤–∞ –ø–æ—à—Ç–∞ —É –º. –û–±—É—Ö—ñ–≤</b><br><small style="font-size: 0.8rem;">–∞–±–æ –ø–æ—à—Ç–æ–º–∞—Ç</small></label>
                <span class="price">1 –≥—Ä–Ω</span>
            </div>
            <div class="delivery-option">
                <input type="radio" id="nova-poshta" name="delivery" value="0" data-title="–ù–æ–≤–∞ –ü–æ—à—Ç–∞ –ø–æ –£–∫—Ä–∞—ó–Ω—ñ">
                <label for="nova-poshta"><b>–ù–æ–≤–∞ –ø–æ—à—Ç–∞ –ø–æ –£–∫—Ä–∞—ó–Ω—ñ</b><br><small style="font-size: 0.8rem;">–∑–∞ —Ç–∞—Ä–∏—Ñ–∞–º–∏ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞</small></label>
            </div>
        </div>

        <div id="address-field-container" class="address-field visible">
            <input type="text" id="address-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –∞–±–æ ‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è">
        </div>

        <h2>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ</h2>
        <p class="error" id="form-error"></p>
        <div class="form-group">
            <input type="text" id="user-name" placeholder="–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ">
        </div>
        <div class="form-group">
            <input type="tel" id="user-phone" placeholder="0 XX XXX XX XX">
        </div>

        <div class="order-notice">
            <i class="fas fa-credit-card"></i>
            –û–ø–ª–∞—Ç–∞ –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è
        </div>
    </div>
</div>

<script type="module">
    // –¢–æ–π —Å–∞–º–∏–π JavaScript –∫–æ–¥ –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª—É
    const AppState = {
        products: [],
        cart: {},
        isFormVisible: false,
        tg: null,
    };

    const elements = {
        loading: document.getElementById('loading'),
        productList: document.getElementById('product-list'),
        searchInput: document.getElementById('search-input'),
        cartBadge: document.getElementById('cart-badge'),
        cartCount: document.getElementById('cart-count'),
        promoSection: document.getElementById('promo-section'),
        promoCloseBtn: document.getElementById('promo-close'),
        orderForm: document.getElementById('order-form'),
        orderFormCloseBtn: document.getElementById('order-form-close-btn'),
        changeOrderBtn: document.querySelector('.change-order-btn'),
        deliveryOptions: document.querySelectorAll('input[name="delivery"]'),
        addressContainer: document.getElementById('address-field-container'),
        orderSummary: document.getElementById('order-summary'),
        userNameInput: document.getElementById("user-name"),
        userPhoneInput: document.getElementById("user-phone"),
        addressInput: document.getElementById("address-input"),
        formError: document.getElementById("form-error"),
        modal: document.getElementById('description-modal'),
        modalTitle: document.getElementById('modal-title'),
        modalBody: document.getElementById('modal-body'),
        modalCloseBtn: document.getElementById('modal-close-btn'),
        testSendBtn: document.getElementById('test-send-btn'),
    };

    function createProductElement(product) {
        const card = document.createElement("div");
        card.className = "product-card";
        card.dataset.id = product.id;

        const priceHTML = product.original_price
            ? `<span class="current-price">${product.price.toFixed(2)} –≥—Ä–Ω</span><span class="original-price">${product.original_price.toFixed(2)} –≥—Ä–Ω</span>`
            : `<span class="current-price">${product.price.toFixed(2)} –≥—Ä–Ω</span>`;

        card.innerHTML = `
            <img src="${product.images[0]}" alt="${product.name}" class="gallery-image" onerror="this.onerror=null;this.src='https://placehold.co/300x300/FF6B35/FFFFFF?text=${encodeURIComponent(product.name)}';"/>
            <div class="product-info">
                <div class="title">${product.name}</div>
                <div class="weight"><i class="fas fa-cube"></i> ${product.weight}</div>
                <div class="price-container">${priceHTML}</div>
                <div class="card-footer">
                    <button class="add-to-cart-btn" title="–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫"><i class="fas fa-plus"></i></button>
                    <div class="quantity-control" style="display: none;">
                        <button class="quantity-btn" data-action="decrease"><i class="fas fa-minus"></i></button>
                        <span class="quantity">1</span>
                        <button class="quantity-btn" data-action="increase"><i class="fas fa-plus"></i></button>
                    </div>
                    <button class="details-btn" data-title="${product.name}" data-description="${product.description.replace(/"/g, '&quot;')}"><i class="fas fa-circle-info"></i></button>
                </div>
            </div>`;
        return card;
    }

    function updateCart(productId, action) {
        const product = AppState.products.find(p => p.id == productId);
        if (!product) return;

        if (action === 'add' && !AppState.cart[productId]) {
            AppState.cart[productId] = { name: product.name, price: product.price, quantity: 1 };
        } else if (action === 'increase' && AppState.cart[productId]) {
            AppState.cart[productId].quantity++;
        } else if (action === 'decrease' && AppState.cart[productId]) {
            AppState.cart[productId].quantity--;
            if (AppState.cart[productId].quantity <= 0) {
                delete AppState.cart[productId];
            }
        }
        updateUI();
    }

    function openOrderForm() {
        AppState.isFormVisible = true;
        renderOrderSummary();
        elements.orderForm.classList.add("visible");
        AppState.tg?.BackButton.show();
        updateUI();
    }

    function closeOrderForm() {
        AppState.isFormVisible = false;
        elements.orderForm.classList.remove("visible");
        AppState.tg?.BackButton.hide();
        updateUI();
    }

    function renderOrderSummary() {
        if (!elements.orderSummary) return;

        let itemsHTML = "";
        let productsTotal = 0;
        let totalDiscount = 0;

        for (const id in AppState.cart) {
            const product = AppState.products.find(p => p.id == id);
            const item = AppState.cart[id];
            if (!product) continue;

            const itemTotalPrice = item.price * item.quantity;
            productsTotal += itemTotalPrice;

            if (product.original_price) {
                totalDiscount += (product.original_price - item.price) * item.quantity;
            }

            itemsHTML += `
                <div class="summary-item">
                    <img src="${product.images[0]}" alt="${item.name}" class="summary-item-img" onerror="this.onerror=null;this.src='https://placehold.co/64x64/FF6B35/FFFFFF?text=üßÄ';">
                    <div class="summary-item-details">
                        <div class="summary-item-name">${item.name}</div>
                        <div class="summary-item-quantity">${item.quantity} √ó ${item.price.toFixed(2)} –≥—Ä–Ω</div>
                    </div>
                    <div class="summary-item-price">${itemTotalPrice.toFixed(2)} –≥—Ä–Ω</div>
                </div>`;
        }

        const selectedDelivery = document.querySelector('input[name="delivery"]:checked');
        const deliveryCost = parseInt(selectedDelivery ? selectedDelivery.value : "0", 10) || 0;
        const finalTotal = productsTotal + deliveryCost;

        const totalsHTML = `
            <div class="summary-totals">
                ${totalDiscount > 0 ? `<div class="total-discount"><span><i class="fas fa-tag"></i> –ó–Ω–∏–∂–∫–∞:</span><span>-${totalDiscount.toFixed(2)} –≥—Ä–Ω</span></div>` : ""}
                ${deliveryCost > 0 ? `<div><span><i class="fas fa-truck"></i> –î–æ—Å—Ç–∞–≤–∫–∞:</span><span>${deliveryCost.toFixed(2)} –≥—Ä–Ω</span></div>` : ""}
                <div class="total-price"><span>–†–∞–∑–æ–º:</span><span>${finalTotal.toFixed(2)} –≥—Ä–Ω</span></div>
            </div>`;

        elements.orderSummary.innerHTML = itemsHTML + totalsHTML;
    }

    function initializeTelegramWebApp() {
        try {
            AppState.tg = window.Telegram?.WebApp;
            if (AppState.tg) {
                AppState.tg.ready();
                AppState.tg.expand();
            } else {
                AppState.tg = {
                    initData: 'dev_mode',
                    initDataUnsafe: { user: { id: 'test', first_name: 'Test', last_name: 'User' } },
                    MainButton: {
                        setText: () => {},
                        show: () => {},
                        hide: () => {},
                        setParams: () => {},
                    },
                    BackButton: {
                        show: () => {},
                        hide: () => {},
                    },
                    onEvent: () => {},
                    close: () => {},
                    showAlert: (msg) => alert(msg),
                };
            }
        } catch (e) {
            console.warn('TG init error:', e);
        }
    }

    const API_URLS = {
        PRODUCTS: './data/products.json',
        SUBMIT_ORDER: 'https://urfine.com.ua/fct/hs/bots/order/'
    };

    function notifyUser(message) {
        if (typeof AppState.tg?.showAlert === 'function') {
            AppState.tg.showAlert(message);
        } else {
            window.alert(message);
        }
    }

    function sendDataToBot(payload) {
        const serialized = JSON.stringify(payload);
        if (typeof AppState.tg?.sendData === 'function') {
            try {
                AppState.tg.sendData(serialized);
                return true;
            } catch (error) {
                console.error('sendData error:', error);
                notifyUser('–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ Telegram. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
            }
        } else {
            notifyUser('sendData –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π —É —Ü—å–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ä–µ–∑–µ—Ä–≤–Ω–∏–π –∫–∞–Ω–∞–ª.');
        }
        return false;
    }

    function sendTestPayload() {
        const payload = {
            type: 'test_order',
            timestamp: Date.now(),
            message: '–¶–µ —Ç–µ—Å—Ç–æ–≤–∏–π –∑–∞–ø–∏—Ç –∑ Mini App'
        };

        const isSent = sendDataToBot(payload);
        if (isSent) {
            notifyUser('–¢–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ —á–µ—Ä–µ–∑ Telegram.');
        } else {
            console.warn('sendData fallback payload:', payload);
            notifyUser('sendData –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ Mini App –≤—ñ–¥–∫—Ä–∏—Ç–æ –∑ –∫–Ω–æ–ø–∫–∏ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏, –∞–±–æ —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —Ä–µ–∞–ª—å–Ω–∏–º –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º.');
        }
    }

    async function loadProducts() {
        elements.loading.style.display = 'flex';
        try {
            const response = await fetch(API_URLS.PRODUCTS);
            if (!response.ok) throw new Error('Network error');
            AppState.products = await response.json();
        } catch (error) {
            console.error('Load error:', error);
            AppState.products = [];
        } finally {
            elements.loading.style.display = 'none';
        }
    }

    function validateOrderForm() {
        elements.formError.textContent = "";

        if (elements.userNameInput.value.trim().length < 3) {
            elements.formError.textContent = "–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ";
            return null;
        }

        if (!/^\+?3?8?(0\d{9})$/.test(elements.userPhoneInput.value.replace(/\s/g, ""))) {
            elements.formError.textContent = "–í–≤–µ–¥—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω";
            return null;
        }

        let rawTotalPrice = 0;
        let rawTotalDiscount = 0;
        const cartAsArray = Object.keys(AppState.cart).map(id => {
            const product = AppState.products.find(p => p.id == id);
            const item = AppState.cart[id];
            rawTotalPrice += item.price * item.quantity;
            if (product?.original_price) {
                rawTotalDiscount += (product.original_price - item.price) * item.quantity;
            }
            return { id, ...item };
        });

        const selectedDelivery = document.querySelector('input[name="delivery"]:checked');
        const deliveryData = {
            id: selectedDelivery.id,
            cost: parseInt(selectedDelivery.value, 10) || 0,
            address: elements.addressInput.value
        };

        return {
            userId: AppState.tg.initDataUnsafe?.user?.id || 'user',
            user: { name: elements.userNameInput.value, phone: elements.userPhoneInput.value },
            cart: cartAsArray,
            totalPrice: (rawTotalPrice + deliveryData.cost).toFixed(2),
            totalDiscount: rawTotalDiscount.toFixed(2),
            delivery: deliveryData
        };
    }
    function submitOrder() {
        const orderData = validateOrderForm();
        if (!orderData) return;

        const payload = { type: 'order', data: orderData };
        const sentViaTelegram = sendDataToBot(payload);

        if (sentViaTelegram) return;

        fetch(API_URLS.SUBMIT_ORDER, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
        })
        .then(() => notifyUser('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ!'))
        .catch(error => {
            console.error('Order error:', error);
            notifyUser('–ù–µ –≤–¥–∞–ª–æ—Å—è –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.');
        })
        .finally(() => AppState.tg?.close?.());
    }

    function renderProducts() {
        const query = elements.searchInput.value.toLowerCase();
        const filtered = AppState.products.filter(p =>
            p.name.toLowerCase().includes(query) || p.description.toLowerCase().includes(query)
        );

        elements.productList.innerHTML = "";
        if (filtered.length === 0) {
            elements.productList.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 2rem; color: var(--text-secondary);">–¢–æ–≤–∞—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>`;
            return;
        }
        filtered.forEach(product => {
            elements.productList.appendChild(createProductElement(product));
        });
    }

    function updateCartControls() {
        document.querySelectorAll('.product-card').forEach(card => {
            const id = card.dataset.id;
            const addBtn = card.querySelector('.add-to-cart-btn');
            const quantityControl = card.querySelector('.quantity-control');
            
            if (AppState.cart[id]) {
                addBtn.style.display = 'none';
                quantityControl.style.display = 'flex';
                quantityControl.querySelector('.quantity').textContent = AppState.cart[id].quantity;
            } else {
                addBtn.style.display = 'flex';
                quantityControl.style.display = 'none';
            }
        });
    }

    function updateMainButton() {
        const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);
        if (totalItems > 0) {
            const text = AppState.isFormVisible ? '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏' : `–ö–æ—à–∏–∫ (${totalItems})`;
            AppState.tg.MainButton.setText(text);
            AppState.tg.MainButton.setParams({
                color: '#FF6B35',
                has_shine_effect: true,
                text_color: '#FFFFFF'
            });
            AppState.tg.MainButton.show();
        } else {
            AppState.tg.MainButton.hide();
            if (AppState.isFormVisible) closeOrderForm();
        }
    }

    function updateUI() {
        renderProducts();
        updateCartControls();
        const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);
        elements.cartCount.textContent = totalItems;
        elements.cartCount.classList.toggle('hidden', totalItems === 0);
        if (AppState.tg) updateMainButton();
    }

    function showProductDetailsModal(title, description) {
        elements.modalTitle.textContent = title;
        elements.modalBody.innerHTML = description.replace(/\n/g, '<br>');
        elements.modal.classList.add('visible');
        AppState.tg?.BackButton.show();
    }

    function closeProductDetailsModal() {
        elements.modal.classList.remove('visible');
        if (!AppState.isFormVisible) AppState.tg?.BackButton.hide();
    }

    function handleProductClick(e) {
        const card = e.target.closest('.product-card');
        if (!card) return;

        const productId = card.dataset.id;
        
        if (e.target.closest('.add-to-cart-btn')) {
            updateCart(productId, 'add');
        } else if (e.target.closest('.quantity-btn')) {
            const action = e.target.closest('.quantity-btn').dataset.action;
            updateCart(productId, action);
        } else if (e.target.closest('.details-btn')) {
            const btn = e.target.closest('.details-btn');
            showProductDetailsModal(btn.dataset.title, btn.dataset.description);
        }
    }

    function initEventListeners() {
        elements.cartBadge.addEventListener('click', () => {
            if (Object.keys(AppState.cart).length > 0) openOrderForm();
        });
        elements.changeOrderBtn?.addEventListener('click', closeOrderForm);
        elements.orderFormCloseBtn?.addEventListener('click', closeOrderForm);
        elements.searchInput.addEventListener('input', () => updateUI());
        elements.productList.addEventListener('click', handleProductClick);
        elements.deliveryOptions.forEach(opt => {
            opt.addEventListener('change', renderOrderSummary);
        });
        elements.modalCloseBtn.addEventListener('click', closeProductDetailsModal);
        elements.modal.addEventListener('click', (e) => {
            if (e.target === elements.modal) closeProductDetailsModal();
        });
        elements.promoCloseBtn.addEventListener('click', () => {
            elements.promoSection.style.display = 'none';
        });
        elements.testSendBtn?.addEventListener('click', sendTestPayload);

        if (AppState.tg) {
            AppState.tg.onEvent('backButtonClicked', () => {
                if (elements.modal.classList.contains('visible')) closeProductDetailsModal();
                else if (AppState.isFormVisible) closeOrderForm();
            });
            AppState.tg.onEvent('mainButtonClicked', () => {
                if (!AppState.isFormVisible) openOrderForm();
                else submitOrder();
            });
        }
    }

    function initApp() {
        initializeTelegramWebApp();
        initEventListeners();
        loadProducts().then(() => updateUI());
    }

    document.addEventListener('DOMContentLoaded', initApp);
</script>
</body>
</html>

