<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Family Cheese - –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —Å–∏—Ä–∏</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- –í–±—É–¥–æ–≤–∞–Ω—ñ —Å—Ç–∏–ª—ñ CSS –∑ —É—Å—ñ—Ö —Ñ–∞–π–ª—ñ–≤ (variables.css, themes.css, base.css, components.css, style.css) -->
    <style>
/* === –ó–ú–Ü–ù–ù–Ü –¢–ê –¢–ï–ú–ò === */
:root {
    --primary-color: #D4935A; --primary-hover: #C17A3A;
    --secondary-color: #E8B17A; --accent-color: #F2C98A;
    --error-color: #E74C3C; --success-color: #27AE60;
    --bg-primary: #FFF9F4; --bg-secondary: #F8F3ED;
    --bg-tertiary: #F0E6D6; --bg-card: #FFFFFF;
    --text-primary: #8B4513; --text-secondary: #A0522D;
    --text-muted: #CD853F; --border-color: #E6D5C7;
    --shadow-soft: 0 4px 20px rgba(212, 147, 90, 0.15);
    --shadow-medium: 0 8px 30px rgba(212, 147, 90, 0.2);
    --shadow-strong: 0 15px 40px rgba(212, 147, 90, 0.25);
    --gradient-primary: linear-gradient(135deg, #F2C98A 0%, #D4935A 50%, #C17A3A 100%);
    --gradient-secondary: radial-gradient(circle at center, #F5DEB3 0%, #E8B17A 100%);
    --transition-smooth: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --border-radius-soft: 12px; --border-radius-medium: 16px; --border-radius-large: 20px;
}
[data-theme="dark"] {
    --bg-primary: #2C1810; --bg-secondary: #3D2318; --bg-tertiary: #4A2A1C;
    --bg-card: #3D2318; --text-primary: #F5DEB3; --text-secondary: #E8B17A;
    --text-muted: #D4935A; --border-color: #5D3A24;
}

/* === –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü === */
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; font-size: clamp(14px, 1.5vw, 16px); }
body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary); color: var(--text-primary);
    line-height: 1.6; overflow-x: hidden;
    transition: background-color var(--transition-smooth), color var(--transition-smooth);
}
.hidden { display: none !important; }

/* === HEADER === */
.header {
    position: sticky; top: 0; z-index: 1000;
    background: rgba(255, 249, 244, 0.9); backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--border-color); padding: 0.75rem 0;
}
.header-content { display: flex; align-items: center; gap: 0.75rem; padding: 0 1rem; max-width: 1200px; margin: 0 auto; }
.search-container { flex-grow: 1; position: relative; }
.search-input {
    width: 100%; padding: 0.8rem 1rem; border: 2px solid var(--border-color);
    border-radius: var(--border-radius-large); font-size: 1rem;
    background: var(--bg-card); color: var(--text-primary);
    transition: all var(--transition-smooth);
}
.search-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(212, 147, 90, 0.2); }
.search-icon { display: none; }
.header-actions { display: flex; align-items: center; gap: 0.75rem; }
.cart-badge {
    width: 48px; height: 48px; border-radius: 50%; border: none;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: transform 0.3s; font-size: 1.2rem; position: relative;
    background: var(--gradient-primary); color: white; box-shadow: var(--shadow-soft);
}
.cart-badge:hover { transform: scale(1.1); }
.cart-count {
    position: absolute; top: -5px; right: -5px; background: var(--error-color);
    color: white; border-radius: 50%; width: 24px; height: 24px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.75rem; font-weight: 700;
}
@keyframes heartbeat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

/* === PROMO === */
.promo-section { margin: 1rem 0; padding: 0 1rem; }
.promo-box {
    background: var(--gradient-primary); color: white; padding: 1rem 1.5rem;
    border-radius: var(--border-radius-medium); font-size: 1rem; font-weight: 600; text-align: center;
    box-shadow: var(--shadow-soft); animation: pulse 2s infinite; position: relative;
}
.promo-box strong { font-size: 1.2rem; }
.promo-close { position: absolute; top: 8px; right: 12px; background: none; border: none; color: white; font-size: 1.4rem; cursor: pointer; }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(212, 147, 90, 0.6); } 70% { box-shadow: 0 0 0 15px rgba(212, 147, 90, 0); } 100% { box-shadow: 0 0 0 0 rgba(212, 147, 90, 0); } }

/* === LAYOUT & LOADING === */
.container { max-width: 1200px; margin: 0 auto; padding: 0 1rem 2rem; }
.loading { display: flex; justify-content: center; align-items: center; height: 200px; }
.spinner { width: 40px; height: 40px; border: 4px solid var(--border-color); border-top-color: var(--primary-color); border-radius: 50%; animation: spin 1.5s ease-in-out infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* === PRODUCT LIST & CARD === */
.product-list { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 1.5rem; }
.product-card {
    background: var(--bg-card); border-radius: var(--border-radius-large);
    overflow: hidden; box-shadow: var(--shadow-soft);
    transition: transform var(--transition-smooth), box-shadow var(--transition-smooth);
    border: 1px solid var(--border-color);
}
.product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-medium); }
.gallery-image { width: 100%; height: auto;  object-fit: cover; }/*aspect-ratio: 4 / 3;*/
.product-info { padding: 1rem; }
.title { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem; }
.weight { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.75rem; }
.price-container { display: flex; align-items: baseline; gap: 0.75rem; margin-bottom: 1rem; }
.current-price { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
.original-price { font-size: 1rem; color: var(--text-muted); text-decoration: line-through; }
.card-footer { display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
.add-to-cart-btn {
    background: var(--gradient-primary); color: white; border: none; width: 48px; height: 48px;
    border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem; transition: transform 0.3s; box-shadow: var(--shadow-soft);
}
.add-to-cart-btn:hover { transform: scale(1.15); }
.quantity-control { display: flex; align-items: center; gap: 0.75rem; background: var(--bg-secondary); border-radius: var(--border-radius-medium); padding: 0.5rem; }
.quantity-btn { width: 32px; height: 32px; border-radius: 50%; border: none; background: var(--primary-color); color: white; cursor: pointer; font-weight: 700; transition: transform 0.3s; }
.quantity-btn:hover { transform: scale(1.1); }
.quantity { font-weight: 700; min-width: 24px; text-align: center; font-size: 1rem; }
.details-btn { background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 0.9rem; text-decoration: none; }

/* === MODAL & ORDER FORM === */
/* ORDER FORM */
.order-form {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-top-left-radius: var(--border-radius-large);
    border-top-right-radius: var(--border-radius-large);
    max-height: 90vh;
    overflow-y: auto;
    z-index: 1500;
    transform: translateY(100%);
    transition: transform var(--transition-smooth);
    box-shadow: 0 -10px 40px rgba(212, 147, 90, 0.3);
    border-top: 3px solid var(--primary-color);
}

.order-form.visible {
    transform: translateY(0);
}

.order-form-content {
    padding: 2.5rem;
    position: relative;
}

.order-form-close-btn {
    position: absolute;
    top: 2rem;
    right: 2rem;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.6rem;
    background: var(--bg-tertiary);
    color: var(--text-primary);
    transition: all var(--transition-bounce);
    z-index: 10;
    box-shadow: var(--shadow-soft);
}

.order-form-close-btn:hover {
    background: var(--error-color);
    color: white;
    transform: scale(1.15) rotate(90deg);
}

.order-form h2 {
    font-family: 'Comfortaa', sans-serif;
    font-size: 1.6rem;
    font-weight: 600;
    margin-bottom: 2rem;
    color: var(--text-primary);
}

.change-order-btn {
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius-medium);
    cursor: pointer;
    margin-bottom: 2rem;
    transition: all var(--transition-smooth);
    font-weight: 600;
}

.change-order-btn:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-medium);
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 1rem;
    background: var(--bg-secondary);
    border-radius: var(--border-radius-medium);
    margin-bottom: 1rem;
    border: 1px solid var(--border-color);
}

.summary-item-img {
    width: 64px;
    height: 64px;
    border-radius: var(--border-radius-medium);
    object-fit: cover;
    box-shadow: var(--shadow-soft);
}

.summary-item-details {
    flex: 1;
}

.summary-item-name {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.summary-item-quantity {
    color: var(--text-muted);
    font-size: 0.9rem;
}

.summary-item-price {
    font-weight: 700;
    color: var(--primary-color);
    font-size: 1.1rem;
}

.summary-totals {
    background: var(--bg-secondary);
    border-radius: var(--border-radius-large);
    padding: 1.5rem;
    margin: 2rem 0;
    border: 1px solid var(--border-color);
}

.summary-totals>div {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
    font-size: 1.05rem;
}

.total-price {
    font-weight: 700;
    font-size: 1.3rem;
    color: var(--primary-color);
    border-top: 2px solid var(--border-color);
    padding-top: 1rem;
    margin-top: 1rem;
}

.total-discount {
    color: var(--success-color);
    font-weight: 600;
}

.delivery-options {
    margin-bottom: 2rem;
}

.delivery-option {
    display: flex;
    align-items: center;
    padding: 1.2rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-medium);
    margin-bottom: 1rem;
    cursor: pointer;
    transition: all var(--transition-smooth);
}

.delivery-option:hover {
    border-color: var(--primary-color);
    background: rgba(212, 147, 90, 0.05);
}

.delivery-option input[type="radio"] {
    margin-right: 1rem;
    transform: scale(1.2);
    accent-color: var(--primary-color);
}

.delivery-option label {
    flex: 1;
    cursor: pointer;
}

.delivery-option .price {
    font-weight: 700;
    color: var(--primary-color);
}

.address-field {
    margin-bottom: 2rem;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: all var(--transition-smooth);
}

.address-field.visible {
    opacity: 1;
    max-height: 100px;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group input,
.address-field input {
    width: 100%;
    padding: 1.2rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-medium);
    font-size: 1rem;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: all var(--transition-smooth);
    font-family: 'Comfortaa', sans-serif;
}

.form-group input:focus,
.address-field input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(212, 147, 90, 0.2);
    transform: translateY(-2px);
}

.error {
    color: var(--error-color);
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
    text-align: center;
    font-weight: 500;
}

.order-notice {
    background: rgba(212, 147, 90, 0.1);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius-medium);
    padding: 1.2rem;
    margin-bottom: 1rem;
    color: var(--success-color);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.order-notice i {
    color: var(--success-color);
    font-size: 1.2rem;
}
/* === MODAL === */
.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(139, 69, 19, 0.7);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-smooth);
    padding: 1rem;
}

.modal-backdrop.visible {
    opacity: 1;
    visibility: visible;
}

.modal-content {
    background: var(--bg-card);
    border-radius: var(--border-radius-large);
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-strong);
    transform: scale(0.9);
    transition: transform var(--transition-smooth);
}

.modal-backdrop.visible .modal-content {
    transform: scale(1);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    background: var(--bg-secondary);
}

.modal-title {
    font-family: 'Comfortaa', sans-serif;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-primary);
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
}

.modal-close:hover {
    background: var(--bg-tertiary);
    transform: rotate(90deg);
}

.modal-body {
    padding: 1.5rem;
    line-height: 1.7;
    color: var(--text-secondary);
}

/* === INFO SECTIONS === */
.info-section { padding: 2rem 0; margin-top: 2rem; }
.section-title { text-align: center; font-size: 1.8rem; font-weight: 700; margin-bottom: 2rem; color: var(--text-primary); }
.about-content { display: grid; grid-template-columns: 1fr; gap: 2rem; text-align: center; }
.about-image img { width: 100%; border-radius: var(--border-radius-large); box-shadow: var(--shadow-medium); }
.about-text h3 { font-size: 1.5rem; margin-bottom: 1rem; }
.about-text p { color: var(--text-secondary); line-height: 1.7; font-size: 1rem; }
.reviews-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
.review-card { background: var(--bg-card); padding: 1.5rem; border-radius: var(--border-radius-large); box-shadow: var(--shadow-soft); border: 1px solid var(--border-color); }
.review-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
.review-header .fa-user-circle { font-size: 3rem; color: var(--primary-color); }
.reviewer-name { font-weight: 600; font-size: 1.1rem; }
.review-stars { color: #F39C12; font-size: 1rem; }
.review-text { color: var(--text-secondary); font-style: italic; font-size: 1rem; }

/* === –ê–î–ê–ü–¢–ò–í–ù–Ü–°–¢–¨ (TABLET & DESKTOP) === */
@media (min-width: 600px) {
    .product-list { grid-template-columns: repeat(2, 1fr); }
    .reviews-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (min-width: 768px) {
    :root { font-size: 16px; }
    .header { padding: 1rem 0; }
    .header-content { gap: 1.5rem; padding: 0 1.5rem; }
    .search-input { padding: 1rem 1rem 1rem 3.5rem; }
    .search-icon { display: block; position: absolute; left: 1.2rem; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 1.2rem; }
    .container { padding: 0 1.5rem 3rem; }
    .product-list { margin-top: 2rem; }
    .product-info { padding: 1.5rem; }
    .section-title { font-size: 2.2rem; }
    .about-content { grid-template-columns: 1fr 1.5fr; text-align: left; }
}
@media (min-width: 1024px) {
    .product-list { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; }
    .reviews-grid { grid-template-columns: repeat(3, 1fr); }
}
</style>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <header class="header">
    <div class="header-content">
        <!-- –õ–æ–≥–æ—Ç–∏–ø –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ Telegram WebApp, —ñ —Ñ–æ–∫—É—Å –Ω–∞ —Ç–æ–≤–∞—Ä–∞—Ö -->
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="–ü–æ—à—É–∫ —Å–∏—Ä—ñ–≤..." id="search-input">
        </div>
        <div class="header-actions">
            <!-- –ö–Ω–æ–ø–∫–∞ "–ö–æ—à–∏–∫" (–¥–ª—è –≤—ñ–∑—É–∞–ª—å–Ω–æ–≥–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, —Ö–æ—á–∞ –æ—Å–Ω–æ–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞ - TG MainButton) -->
            <button class="cart-badge" id="cart-badge" title="–ö–æ—à–∏–∫">
                <span class="cart-count hidden" id="cart-count">0</span>
                <i class="fas fa-shopping-cart"></i>
            </button>
        </div>
    </div>
</header>

<!-- üîî –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∑–Ω–∏–∂–∫—É -->
<section class="promo-section" id="promo-section">
  <div class="container">
    <div class="promo-box">
      üéâ –õ–∏—à–µ –∑–∞—Ä–∞–∑! <strong>-15%</strong> –Ω–∞ –≤—Å—ñ —Å–∏—Ä–∏ üßÄ  
      <span class="promo-sub">–í—Å—Ç–∏–≥–Ω—ñ—Ç—å –∑–∞–º–æ–≤–∏—Ç–∏ –¥–æ –∫—ñ–Ω—Ü—è —Ç–∏–∂–Ω—è!</span>
      <button class="promo-close" id="promo-close">√ó</button>
    </div>
  </div>
</section>

<div class="container">
    <div class="loading" id="loading">
        <div class="spinner"></div>
        –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–∞–ª–æ–≥—É...
    </div>
    <div class="product-list" id="product-list"></div>
</div>

<!-- –°–µ–∫—Ü—ñ—è –≤—ñ–¥–≥—É–∫—ñ–≤ -->
<section id="reviews" class="info-section">
    <div class="container">
        <h2 class="section-title">–í—ñ–¥–≥—É–∫–∏ –Ω–∞—à–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤</h2>
        <div class="reviews-grid">
            <div class="review-card">
                <div class="review-header">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <p class="reviewer-name">–û–ª–µ–Ω–∞ –ü.</p>
                        <div class="review-stars">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star"></i>
                        </div>
                    </div>
                </div>
                <p class="review-text">"–ù–µ–π–º–æ–≤—ñ—Ä–Ω–æ —Å–º–∞—á–Ω–∏–π —Å–∏—Ä! –ì–∞—É–¥–∞ –ø—Ä–æ—Å—Ç–æ —Ç–∞–Ω–µ –≤ —Ä–æ—Ç—ñ. –í—ñ–¥—á—É–≤–∞—î—Ç—å—Å—è, —â–æ –ø—Ä–æ–¥—É–∫—Ç
                    –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∏–π —ñ –∑—Ä–æ–±–ª–µ–Ω–∏–π –∑ –¥—É—à–µ—é. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –∑–∞–º–æ–≤–ª—é —â–µ!"</p>
            </div>
            <div class="review-card">
                <div class="review-header">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <p class="reviewer-name">–ê–Ω–¥—Ä—ñ–π</p>
                        <div class="review-stars">
                            <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i
                                class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                        </div>
                    </div>
                </div>
                <p class="review-text">"–ó–∞–º–æ–≤–ª—è–≤ –¥–æ—Å—Ç–∞–≤–∫—É –ø–æ –û–±—É—Ö–æ–≤—É, –≤—Å–µ –ø—Ä–∏–≤–µ–∑–ª–∏ —à–≤–∏–¥–∫–æ. –°–∏—Ä —Å–≤—ñ–∂–∏–π, –∞—Ä–æ–º–∞—Ç–Ω–∏–π.
                    –¢—Ä–æ—Ö–∏ –¥–æ—Ä–æ–∂—á–µ, –Ω—ñ–∂ –≤ –º–∞–≥–∞–∑–∏–Ω—ñ, –∞–ª–µ —è–∫—ñ—Å—Ç—å —Ç–æ–≥–æ –≤–∞—Ä—Ç–∞."</p>
            </div>
        </div>
    </div>
</section>

<!-- –°–µ–∫—Ü—ñ—è "–ü—Ä–æ –ù–∞—Å" -->
<section id="about-us" class="info-section">
    <div class="container">
        <h2 class="section-title">–ü—Ä–æ –ù–∞—Å</h2>
        <div class="about-content">
            <div class="about-image">
                <img src="data/pro_nas.png" alt="–ù–∞—à–∞ —Å–∏—Ä–æ–≤–∞—Ä–Ω—è">
            </div>
            <div class="about-text">
                <h3>–°—ñ–º–µ–π–Ω–∞ —Å–ø—Ä–∞–≤–∞ –∑ –ª—é–±–æ–≤'—é –¥–æ —Å–∏—Ä—É</h3>
                <p>
                    <strong>Family Cheese</strong> ‚Äî —Ü–µ –Ω–µ–≤–µ–ª–∏–∫–∞ —Å—ñ–º–µ–π–Ω–∞ —Å–∏—Ä–æ–≤–∞—Ä–Ω—è, –¥–µ –º–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ñ —Å–∏—Ä–∏
                    –∑–∞ —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–º–∏ —Ä–µ—Ü–µ–ø—Ç–∞–º–∏. –ö–æ–∂–Ω–∞ –≥–æ–ª–æ–≤–∫–∞ —Å–∏—Ä—É ‚Äî —Ü–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä—É—á–Ω–æ—ó –ø—Ä–∞—Ü—ñ, —è–∫—ñ—Å–Ω–æ–≥–æ –º–æ–ª–æ–∫–∞ —Ç–∞
                    –Ω–∞—à–æ—ó –ø—Ä–∏—Å—Ç—Ä–∞—Å—Ç—ñ –¥–æ —Å–∏—Ä–æ–≤–∞—Ä—ñ–Ω–Ω—è. –ú–∏ –≤—ñ—Ä–∏–º–æ, —â–æ –Ω–∞–π–∫—Ä–∞—â–∏–π –ø—Ä–æ–¥—É–∫—Ç –Ω–∞—Ä–æ–¥–∂—É—î—Ç—å—Å—è –ª–∏—à–µ –∑ –Ω–∞–π–∫—Ä–∞—â–∏—Ö
                    —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ —Ç–∞ –¥–±–∞–π–ª–∏–≤–æ–≥–æ —Å—Ç–∞–≤–ª–µ–Ω–Ω—è.
                </p>
            </div>
        </div>
    </div>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å—É —Ç–æ–≤–∞—Ä—É -->
<div class="modal-backdrop" id="description-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-title"></h2>
            <button class="modal-close" id="modal-close-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="modal-body"></div>
    </div>
</div>

<!-- –§–æ—Ä–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–≤–∏—ó–∂–¥–∂–∞—î –∑–Ω–∏–∑—É) -->
<div id="order-form" class="order-form">
    <div class="order-form-content">
        <h2>–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
        <button class="order-form-close-btn" id="order-form-close-btn" title="–ó–∞–∫—Ä–∏—Ç–∏">
            <i class="fas fa-times"></i>
        </button>
        
        <div id="order-summary"></div>
        
        <div class="order-notice">
            <i class="fas fa-info-circle"></i>
            –ü—ñ—Å–ª—è –∑–≤–∞–∂—É–≤–∞–Ω–Ω—è —Å—É–º–∞ –≤–∞—à–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω–µ —â–µ –º–µ–Ω—à–æ—é!
        </div>

        <button class="change-order-btn">
            <i class="fas fa-edit"></i>
            –ó–º—ñ–Ω–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        </button>

        <div class="delivery-options">
            <h2>–°–ø–æ—Å—ñ–± –¥–æ—Å—Ç–∞–≤–∫–∏</h2>
            <div class="delivery-option">
                <input type="radio" id="obukhiv-delivery" name="delivery" value="50" data-title="–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –º. –û–±—É—Ö—ñ–≤" checked>
                <label for="obukhiv-delivery">
                    <b>–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –º. –û–±—É—Ö—ñ–≤</b>
                </label>
                <span class="price">50 –≥—Ä–Ω</span>
            </div>
            <div class="delivery-option">
                <input type="radio" id="obukhiv-nova-poshta" name="delivery" value="50" data-title="–î–æ—Å—Ç–∞–≤–∫–∞ –ù–æ–≤–∞ –ø–æ—à—Ç–∞ –º. –û–±—É—Ö—ñ–≤">
                <label for="obukhiv-nova-poshta">
                    <b>–î–æ—Å—Ç–∞–≤–∫–∞ —É –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è ¬´–ù–æ–≤–∞ –ø–æ—à—Ç–∞¬ª</b><br>
                    –∞–±–æ –ø–æ—à—Ç–æ–º–∞—Ç —É –º. –û–±—É—Ö—ñ–≤
                </label>
                <span class="price">50 –≥—Ä–Ω</span>
            </div>
            <div class="delivery-option">
                <input type="radio" id="nova-poshta" name="delivery" value="0" data-title="–ù–æ–≤–∞ –ü–æ—à—Ç–∞">
                <label for="nova-poshta">
                    <b>¬´–ù–æ–≤–∞ –ø–æ—à—Ç–∞¬ª</b><br>
                    –ó–∞ —Ç–∞—Ä–∏—Ñ–∞–º–∏ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∞
                </label>
            </div>
        </div>

        <div id="address-field-container" class="address-field visible">
            <input type="text" id="address-input" placeholder="–í–≤–µ–¥—ñ—Ç—å –≤–∞—à—É –∞–¥—Ä–µ—Å—É –∞–±–æ ‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è">
        </div>

        <h2>–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ</h2>
        <p class="error" id="form-error"></p>
        <div class="form-group">
            <input type="text" id="user-name" placeholder="–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ">
        </div>
        <div class="form-group">
            <input type="tel" id="user-phone" placeholder="0 XX XXX XX XX">
        </div>

       
        <div class="order-notice">
            <i class="fas fa-credit-card"></i>
            –û–ø–ª–∞—Ç–∞ –ø—ñ—Å–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
        </div>
    </div>
</div>

<script type="module">
    // --- –°–¢–ê–ù (AppState.js) ---
    const AppState = {
        products: [],
        cart: {},
        isFormVisible: false,
        tg: null, // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É
    };

    // –ö–æ–ª–µ–∫—Ü—ñ—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ DOM
    const elements = {
        // General
        loading: document.getElementById('loading'),
        productList: document.getElementById('product-list'),
        searchInput: document.getElementById('search-input'),
        
        // Header
        cartBadge: document.getElementById('cart-badge'),
        cartCount: document.getElementById('cart-count'),
        
        // Promo
        promoSection: document.getElementById('promo-section'),
        promoCloseBtn: document.getElementById('promo-close'),

        // Order Form
        orderForm: document.getElementById('order-form'),
        orderFormCloseBtn: document.getElementById('order-form-close-btn'),
        changeOrderBtn: document.querySelector('.change-order-btn'),
        deliveryOptions: document.querySelectorAll('input[name="delivery"]'),
        addressContainer: document.getElementById('address-field-container'),
        orderSummary: document.getElementById('order-summary'),

        // Form inputs
        userNameInput: document.getElementById("user-name"),
        userPhoneInput: document.getElementById("user-phone"),
        addressInput: document.getElementById("address-input"),
        formError: document.getElementById("form-error"),

        // Modal
        modal: document.getElementById('description-modal'),
        modalTitle: document.getElementById('modal-title'),
        modalBody: document.getElementById('modal-body'),
        modalCloseBtn: document.getElementById('modal-close-btn'),
    };

    // --- –ö–û–ú–ü–û–ù–ï–ù–¢–ò ---
    // ProductCard.js
    function createProductElement(product) {
        const card = document.createElement("div");
        card.className = "product-card";
        card.dataset.id = product.id;

        const priceHTML = product.original_price
            ? `<span class="current-price">${product.price.toFixed(2)} –≥—Ä–Ω</span><span class="original-price">${product.original_price.toFixed(2)} –≥—Ä–Ω</span>`
            : `<span class="current-price">${product.price.toFixed(2)} –≥—Ä–Ω</span>`;

        card.innerHTML = `
            <div class="gallery"><img src="${product.images[0]}" alt="${product.name}" class="gallery-image" onerror="this.onerror=null;this.src='https://placehold.co/400x300/F0E6D6/8B4513?text=Family+Cheese';"></div>
            <div class="product-info">
                <div class="title">${product.name}</div>
                <div class="weight"><i class="fas fa-weight"></i> ${product.weight}</div>
                <div class="price-container">${priceHTML}</div>
                <div class="card-footer">
                    <button class="add-to-cart-btn" title="–î–æ–¥–∞—Ç–∏ –≤ –∫–æ—à–∏–∫"><i class="fas fa-plus"></i></button>
                    <div class="quantity-control" style="display: none;">
                        <button class="quantity-btn" data-action="decrease"><i class="fas fa-minus"></i></button>
                        <span class="quantity">1</span>
                        <button class="quantity-btn" data-action="increase"><i class="fas fa-plus"></i></button>
                    </div>
                    <button class="details-btn" data-title="${product.name}" data-description="${product.description.replace(/"/g, '&quot;')}">
                        <i class="fas fa-info-circle"></i> –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ
                    </button>
                </div>
            </div>`;
        return card;
    }

    // Cart.js
    function updateCart(productId, action) {
        const product = AppState.products.find(p => p.id == productId);
        if (!product) return;

        if (action === 'add' && !AppState.cart[productId]) {
            AppState.cart[productId] = { name: product.name, price: product.price, quantity: 1 };
        } else if (action === 'increase' && AppState.cart[productId]) {
            AppState.cart[productId].quantity++;
        } else if (action === 'decrease' && AppState.cart[productId]) {
            AppState.cart[productId].quantity--;
            if (AppState.cart[productId].quantity <= 0) {
                delete AppState.cart[productId];
            }
        }
        
        updateUI();
    }

    // OrderForm.js
    function openOrderForm() {
        AppState.isFormVisible = true;
        renderOrderSummary();
        //toggleAddressField();
        elements.orderForm.classList.add("visible");
        AppState.tg?.BackButton.show();
        updateUI();
    }

    function closeOrderForm() {
        AppState.isFormVisible = false;
        elements.orderForm.classList.remove("visible");
        AppState.tg?.BackButton.hide();
        updateUI();
    }

    function renderOrderSummary() {
        if (!elements.orderSummary) return;

        let itemsHTML = "";
        let productsTotal = 0;
        let totalDiscount = 0;

        for (const id in AppState.cart) {
            const product = AppState.products.find(p => p.id == id);
            const item = AppState.cart[id];
            if (!product) continue;

            const itemTotalPrice = item.price * item.quantity;
            productsTotal += itemTotalPrice;

            if (product.original_price) {
                totalDiscount += (product.original_price - item.price) * item.quantity;
            }

            itemsHTML += `
                <div class="summary-item">
                    <img src="${product.images[0]}" alt="${item.name}" class="summary-item-img" onerror="this.onerror=null;this.src='https://placehold.co/64x64/F0E6D6/8B4513?text=üßÄ';">
                    <div class="summary-item-details">
                        <div class="summary-item-name">${item.name}</div>
                        <div class="summary-item-quantity">${item.quantity} x ${item.price.toFixed(2)} –≥—Ä–Ω</div>
                    </div>
                    <div class="summary-item-price">${itemTotalPrice.toFixed(2)} –≥—Ä–Ω</div>
                </div>`;
        }

        const selectedDelivery = document.querySelector('input[name="delivery"]:checked');
        const deliveryCost = parseInt(selectedDelivery ? selectedDelivery.value : "0", 10) || 0;
        const finalTotal = productsTotal + deliveryCost;

        const totalsHTML = `
            <div class="summary-totals">
                ${totalDiscount > 0 ? `<div class="total-discount"><span><i class="fas fa-tags"></i> –í–∞—à–∞ –∑–Ω–∏–∂–∫–∞:</span><span>-${totalDiscount.toFixed(2)} –≥—Ä–Ω</span></div>` : ""}
                ${deliveryCost > 0 ? `<div><span><i class="fas fa-truck"></i> –î–æ—Å—Ç–∞–≤–∫–∞:</span><span>${deliveryCost.toFixed(2)} –≥—Ä–Ω</span></div>` : ""}
                <div class="total-price">
                    <span><i class="fas fa-receipt"></i> –í—Å—å–æ–≥–æ –¥–æ —Å–ø–ª–∞—Ç–∏:</span>
                    <span>${finalTotal.toFixed(2)} –≥—Ä–Ω</span>
                </div>
            </div>`;

        elements.orderSummary.innerHTML = itemsHTML + totalsHTML;
    }

    //function toggleAddressField() {
        //const selectedDeliveryId = document.querySelector('input[name="delivery"]:checked')?.id;
        //const isAddressNeeded = selectedDeliveryId === "obukhiv-delivery" || selectedDeliveryId === "nova-poshta";
        //elements.addressContainer.classList.toggle("visible", isAddressNeeded);
    //}

    // --- –°–ï–†–í–Ü–°–ò ---
    // telegram.service.js
    function initializeTelegramWebApp() {
        try {
            AppState.tg = window.Telegram?.WebApp;
            if (AppState.tg) {
                AppState.tg.ready();
                AppState.tg.expand();
            } else {
                // Mock object for browser testing if TG is not available
                AppState.tg = {
                    initData: 'dev_mode_init_data',
                    initDataUnsafe: { user: { id: 'demo_user', first_name: 'Test', last_name: 'User' } },
                    MainButton: {
                        setText: (text) => console.log('TG MainButton Text:', text),
                        show: () => console.log('TG MainButton: Show'),
                        hide: () => console.log('TG MainButton: Hide'),
                        setParams: (params) => console.log('TG MainButton Params:', params),
                        onClick: (callback) => console.log('TG MainButton Click Registered'),
                    },
                    BackButton: {
                        show: () => console.log('TG BackButton: Show'),
                        hide: () => console.log('TG BackButton: Hide'),
                        onClick: (callback) => console.log('TG BackButton Click Registered'),
                    },
                    onEvent: (event, callback) => {
                        if (event === 'mainButtonClicked' || event === 'backButtonClicked') {
                            // Mock registration for browser environment
                            if (event === 'mainButtonClicked') elements.cartBadge.addEventListener('click', callback);
                            if (event === 'backButtonClicked') elements.orderFormCloseBtn.addEventListener('click', callback);
                        }
                    },
                    close: () => console.log('TG Close'),
                    showAlert: (message) => console.log(`[TG Alert]: ${message}`), // Using console log instead of alert
                };
            }
        } catch (e) {
            console.warn(`Error initializing Telegram WebApp: ${e.message}`);
        }
    }

    // api.service.js
    const API_URLS = {
        PRODUCTS: './data/products.json', // –ó–∞–ª–∏—à–∞—î–º–æ –¥–ª—è –≥–Ω—É—á–∫–æ—Å—Ç—ñ, –∞–ª–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤–±—É–¥–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ
        USER_DATA: 'https://urfine.com.ua/fct/hs/bots/user/',
        SUBMIT_ORDER: 'https://urfine.com.ua/fct/hs/bots/order/'
    };

    async function loadProducts() {
        // elements.loading.style.display = 'flex';
        // // –û—Å–∫—ñ–ª—å–∫–∏ —Ñ–∞–π–ª–∏ –æ–±'—î–¥–Ω–∞–Ω—ñ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤–±—É–¥–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ
        // AppState.products = generateMockProducts();
        // elements.loading.style.display = 'none';
        

            elements.loading.style.display = 'flex';
        try {
            const response = await fetch(API_URLS.PRODUCTS);
            if (!response.ok) throw new Error('Network response was not ok');
            AppState.products = await response.json();
        } catch (error) {
            console.error('Failed to load products, using mock data:', error);
        } finally {
            elements.loading.style.display = 'none';
        }
    }

    async function fetchUserData() {
        if (!AppState.tg || !AppState.tg.initData) return;
        try {
            const response = await fetch(API_URLS.USER_DATA, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Telegram-Init-Data': AppState.tg.initData },
                body: JSON.stringify({ initData: AppState.tg.initData, userId: AppState.tg.initDataUnsafe.user.id })
            });
            if (!response.ok) throw new Error(`–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ: ${response.status}`);
            const data = await response.json();
            elements.userNameInput.value = elements.userNameInput.value || data.name || `${AppState.tg.initDataUnsafe.user.first_name} ${AppState.tg.initDataUnsafe.user.last_name || ''}`.trim();
            elements.userPhoneInput.value = elements.userPhoneInput.value || data.phone || '';
            elements.addressInput.value = elements.addressInput.value || data.address || '';
        } catch (error) {
            console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:', error.message);
            // Fallback for mock environment
            elements.userNameInput.value = `${AppState.tg.initDataUnsafe.user.first_name} ${AppState.tg.initDataUnsafe.user.last_name || ''}`.trim();
        }
    }

    async function postOrder(data) {
        console.log("Sending order data:", data);
        try {
            // –†–µ–∞–ª—å–Ω–∏–π POST-–∑–∞–ø–∏—Ç –¥–æ –±–µ–∫–µ–Ω–¥—É
            const response = await fetch(API_URLS.SUBMIT_ORDER, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (!response.ok) {
                throw new Error(`–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: ${response.status}`);
            }
            console.log('–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!');
            //AppState.tg?.showAlert('–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ! –û—á—ñ–∫—É–π—Ç–µ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ telegram.');
          } catch (error) {
            console.error(error.message);
            AppState.tg?.showAlert(`–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏: ${error.message}`);
        } finally {
            AppState.tg?.close();
        }
    }

    function submitOrder() {
        const orderData = validateOrderForm();
        if (!orderData) return; // Validation failed
        
        AppState.tg?.showAlert('–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–Ω—è—Ç–æ! –û—á—ñ–∫—É–π—Ç–µ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ telegram.');
        AppState.tg?.close();
        postOrder(orderData);
    }

    // --- –£–¢–ò–õ–Ü–¢–ò ---
    // validators.js
    function validateOrderForm() {
        elements.formError.textContent = "";

        // 1. –í–∞–ª—ñ–¥–∞—Ü—ñ—è —ñ–º–µ–Ω—ñ
        if (elements.userNameInput.value.trim().length < 3) {
            elements.formError.textContent = "–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–µ —ñ–º'—è —Ç–∞ –ø—Ä—ñ–∑–≤–∏—â–µ.";
            elements.userNameInput.focus();
            return null;
        }

        // 2. –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
        if (!/^\+?3?8?(0\d{9})$/.test(elements.userPhoneInput.value.replace(/\s/g, ""))) {
            elements.formError.textContent = "–í–≤–µ–¥—ñ—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω —É —Ñ–æ—Ä–º–∞—Ç—ñ 0XXXXXXXXX.";
            elements.userPhoneInput.focus();
            return null;
        }

        // 3. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –∞–¥—Ä–µ—Å–∏
        if (elements.addressContainer.classList.contains("visible") && elements.addressInput.value.trim().length < 5) {
            elements.formError.textContent = "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –∞–±–æ ‚Ññ –≤—ñ–¥–¥—ñ–ª–µ–Ω–Ω—è.";
            elements.addressInput.focus();
            return null;
        }

        // --- –Ø–∫—â–æ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—Ä–æ–π–¥–µ–Ω–∞, —Ñ–æ—Ä–º—É—î–º–æ –æ–±'—î–∫—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ---
        let rawTotalPrice = 0;
        let rawTotalDiscount = 0;
        const cartAsArray = Object.keys(AppState.cart).map(id => {
            const product = AppState.products.find(p => p.id == id);
            const item = AppState.cart[id];
            rawTotalPrice += item.price * item.quantity;
            if (product && product.original_price) {
                rawTotalDiscount += (product.original_price - item.price) * item.quantity;
            }
            return { id, ...item };
        });
        
        
        const selectedDelivery = document.querySelector('input[name="delivery"]:checked');
        const deliveryData = {
            id: selectedDelivery.id,
            title: selectedDelivery.dataset.title,
            cost: parseInt(selectedDelivery.value, 10) || 0,
            address: elements.addressInput.value
        };

        if (selectedDelivery.id === 'obukhiv-delivery' || selectedDelivery.id === 'obukhiv-nova-poshta') {
            cartAsArray.push({
                id: '–î–æ—Å—Ç–∞–≤–∫–∞',      // –ê—Ä—Ç–∏–∫—É–ª
                price: 50,           // –§—ñ–∫—Å–æ–≤–∞–Ω–∞ —Ü—ñ–Ω–∞
                quantity: 1          // –ö—ñ–ª—å–∫—ñ—Å—Ç—å
            });
        }

        const userId = AppState.tg.initDataUnsafe?.user?.id || 'browser_user';
        const initData = AppState.tg.initData || 'browser_init_data';

        return {
            userId: userId,
            user: { name: elements.userNameInput.value, phone: elements.userPhoneInput.value },
            initData: initData,
            cart: cartAsArray,
            totalPrice: (rawTotalPrice + deliveryData.cost).toFixed(2),
            totalDiscount: rawTotalDiscount.toFixed(2),
            delivery: deliveryData
        };
    }

    // --- UI –ú–ï–ù–ï–î–ñ–ú–ï–ù–¢ ---
    // uiManager.js
    function renderProducts() {
        const query = elements.searchInput.value.toLowerCase();
        const filteredProducts = AppState.products.filter(p =>
            p.name.toLowerCase().includes(query) || p.description.toLowerCase().includes(query)
        );

        elements.productList.innerHTML = "";
        if (filteredProducts.length === 0) {
            elements.productList.innerHTML = `<div style="grid-column: 1/-1; text-align: center; padding: 2rem;"><h3>–¢–æ–≤–∞—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3></div>`;
            return;
        }
        filteredProducts.forEach(product => {
            elements.productList.appendChild(createProductElement(product));
        });
    }

    function updateCartControls() {
        document.querySelectorAll('.product-card').forEach(card => {
            const id = card.dataset.id;
            const addBtn = card.querySelector('.add-to-cart-btn');
            const quantityControl = card.querySelector('.quantity-control');
            
            if (AppState.cart[id]) {
                setTimeout(() => {
                    addBtn.style.display = 'none';
                    quantityControl.style.display = 'flex';
                    quantityControl.querySelector('.quantity').textContent = AppState.cart[id].quantity;
                }, 100);
            } else {
                addBtn.style.display = 'flex';
                quantityControl.style.display = 'none';
            }
        });
    }

    function updateMainButton() {
        const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);

        if (totalItems > 0) {
            const buttonText = AppState.isFormVisible ? '–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è' : `–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–æ—à–∏–∫ (${totalItems})`;
            AppState.tg.MainButton.setText(buttonText);
            AppState.tg.MainButton.setParams({
                color: '#D4935A',
                has_shine_effect: true,
                text_color: '#FFFFFF'
            });
            AppState.tg.MainButton.show();
        } else {
            AppState.tg.MainButton.hide();
            if (AppState.isFormVisible) closeOrderForm();
        }
    }

    function updateUI() {
        renderProducts();
        updateCartControls();

        const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);
        elements.cartCount.textContent = totalItems;
        elements.cartCount.classList.toggle('hidden', totalItems === 0);
        
        if(AppState.tg) {
            updateMainButton();
        }
    }

    function showProductDetailsModal(title, description) {
        elements.modalTitle.textContent = title;
        elements.modalBody.innerHTML = description.replace(/\n/g, '<br><br>');
        elements.modal.classList.add('visible');
        AppState.tg?.BackButton.show();
    }

    function closeProductDetailsModal() {
        elements.modal.classList.remove('visible');
        // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –¢–ì, —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ –Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç–∞ —Ñ–æ—Ä–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
        if (!AppState.isFormVisible) {
            AppState.tg?.BackButton.hide();
        }
    }

    // --- –û–ë–†–û–ë–ù–ò–ö–ò –ü–û–î–Ü–ô ---
    // productHandler.js
    function handleProductClick(e) {
        const card = e.target.closest('.product-card');
        if (!card) return;

        const productId = card.dataset.id;
        
        if (e.target.closest('.add-to-cart-btn')) {
            updateCart(productId, 'add');
        } else if (e.target.closest('.quantity-btn')) {
            const action = e.target.closest('.quantity-btn').dataset.action;
            updateCart(productId, action);
        } else if (e.target.closest('.details-btn')) {
            const detailsBtn = e.target.closest('.details-btn');
            const title = detailsBtn.dataset.title;
            const description = detailsBtn.dataset.description;
            showProductDetailsModal(title, description);
        }
    }
    
    // Promo
    function closePromo() {
        elements.promoSection.classList.add("promo-hide");
        setTimeout(() => elements.promoSection.style.display = "none", 400);
    }
    
    function initEventListeners() {
        // Cart & Order Form
        elements.cartBadge.addEventListener('click', () => {
            if (Object.keys(AppState.cart).length > 0) openOrderForm();
        });
        elements.changeOrderBtn?.addEventListener('click', closeOrderForm);
        elements.orderFormCloseBtn?.addEventListener('click', closeOrderForm);

        // Search
        elements.searchInput.addEventListener('input', () => updateUI());

        // Products
        elements.productList.addEventListener('click', handleProductClick);

        // Delivery Options
        elements.deliveryOptions.forEach(option => {
            option.addEventListener('change', () => {
                renderOrderSummary();
                //toggleAddressField();
            });
        });

        // Modal Handlers
        elements.modalCloseBtn.addEventListener('click', closeProductDetailsModal);
        elements.modal.addEventListener('click', (e) => {
            if (e.target === elements.modal) {
                closeProductDetailsModal();
            }
        });

        // Promo Close
        elements.promoCloseBtn.addEventListener('click', closePromo);

        // Telegram WebApp Handlers
        if (AppState.tg) {
            AppState.tg.onEvent('backButtonClicked', () => {
                if (elements.modal.classList.contains('visible')) {
                    closeProductDetailsModal();
                } else if (AppState.isFormVisible) {
                    closeOrderForm();
                }
            });
            AppState.tg.onEvent('mainButtonClicked', () => {
                if (!AppState.isFormVisible) {
                    openOrderForm();
                } else {
                    submitOrder();
                }
            });
        }
    }

    // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ---
    function initApp() {
        console.log('üöÄ Initializing Family Cheese app...');
        initializeTelegramWebApp();
        initEventListeners();
        fetchUserData();
        
        loadProducts().then(() => {
            updateUI();
            console.log('‚úÖ App initialized successfully');
        });
    }

    document.addEventListener('DOMContentLoaded', initApp);

</script>
</body>
</html>
