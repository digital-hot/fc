<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Family Cheese - Натуральні сири</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
/* === ЗМІННІ ТА ТЕМИ === */
:root {
    --primary-color: #D4935A; --primary-hover: #C17A3A;
    --secondary-color: #E8B17A; --accent-color: #F2C98A;
    --error-color: #E74C3C; --success-color: #27AE60;
    --bg-primary: #FFF9F4; --bg-secondary: #F8F3ED;
    --bg-tertiary: #F0E6D6; --bg-card: #FFFFFF;
    --text-primary: #8B4513; --text-secondary: #A0522D;
    --text-muted: #CD853F; --border-color: #E6D5C7;
    --shadow-soft: 0 4px 20px rgba(212, 147, 90, 0.15);
    --shadow-medium: 0 8px 30px rgba(212, 147, 90, 0.2);
    --shadow-strong: 0 15px 40px rgba(212, 147, 90, 0.25);
    --gradient-primary: linear-gradient(135deg, #F2C98A 0%, #D4935A 50%, #C17A3A 100%);
    --gradient-secondary: radial-gradient(circle at center, #F5DEB3 0%, #E8B17A 100%);
    --transition-smooth: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --transition-bounce: 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    --border-radius-soft: 12px; --border-radius-medium: 16px; --border-radius-large: 20px;
}
[data-theme="dark"] {
    --bg-primary: #2C1810; --bg-secondary: #3D2318; --bg-tertiary: #4A2A1C;
    --bg-card: #3D2318; --text-primary: #F5DEB3; --text-secondary: #E8B17A;
    --text-muted: #D4935A; --border-color: #5D3A24;
}

/* === БАЗОВІ СТИЛІ === */
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; font-size: clamp(14px, 1.5vw, 16px); }
body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary); color: var(--text-primary);
    line-height: 1.6; overflow-x: hidden;
    transition: background-color var(--transition-smooth), color var(--transition-smooth);
}
.hidden { display: none !important; }

/* === HEADER === */
.header {
    position: sticky; top: 0; z-index: 1000;
    background: rgba(255, 249, 244, 0.9); backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--border-color); padding: 0.75rem 0;
}
.header-content { display: flex; align-items: center; gap: 0.75rem; padding: 0 1rem; max-width: 1200px; margin: 0 auto; }
.search-container { flex-grow: 1; position: relative; }
.search-input {
    width: 100%; padding: 0.8rem 1rem; border: 2px solid var(--border-color);
    border-radius: var(--border-radius-large); font-size: 1rem;
    background: var(--bg-card); color: var(--text-primary);
    transition: all var(--transition-smooth);
}
.search-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(212, 147, 90, 0.2); }
.search-icon { display: none; }
.header-actions { display: flex; align-items: center; gap: 0.75rem; }
.cart-badge {
    width: 48px; height: 48px; border-radius: 50%; border: none;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: transform 0.3s; font-size: 1.2rem; position: relative;
    background: var(--gradient-primary); color: white; box-shadow: var(--shadow-soft);
}
.cart-badge:hover { transform: scale(1.1); }
.cart-count {
    position: absolute; top: -5px; right: -5px; background: var(--error-color);
    color: white; border-radius: 50%; width: 24px; height: 24px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.75rem; font-weight: 700;
}

/* === PROMO === */
.promo-section { margin: 1rem 0; padding: 0 1rem; }
.promo-box {
    background: var(--gradient-primary); color: white; padding: 1rem 1.5rem;
    border-radius: var(--border-radius-medium); font-size: 1rem; font-weight: 600; text-align: center;
    box-shadow: var(--shadow-soft); animation: pulse 2s infinite; position: relative;
}
.promo-box strong { font-size: 1.2rem; }
.promo-close { position: absolute; top: 8px; right: 12px; background: none; border: none; color: white; font-size: 1.4rem; cursor: pointer; }
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(212, 147, 90, 0.6); } 70% { box-shadow: 0 0 0 15px rgba(212, 147, 90, 0); } 100% { box-shadow: 0 0 0 0 rgba(212, 147, 90, 0); } }

/* === LAYOUT & LOADING === */
.container { max-width: 1200px; margin: 0 auto; padding: 0 1rem 2rem; }
.loading { display: flex; justify-content: center; align-items: center; height: 200px; }
.spinner { width: 40px; height: 40px; border: 4px solid var(--border-color); border-top-color: var(--primary-color); border-radius: 50%; animation: spin 1.5s ease-in-out infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* === PRODUCT LIST & CARD === */
.product-list { display: grid; grid-template-columns: 1fr; gap: 1.5rem; margin-top: 1.5rem; }
.product-card {
    background: var(--bg-card); border-radius: var(--border-radius-large);
    overflow: hidden; box-shadow: var(--shadow-soft);
    transition: transform var(--transition-smooth), box-shadow var(--transition-smooth);
    border: 1px solid var(--border-color);
}
.product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-medium); }
.gallery-image { width: 100%; height: auto;  object-fit: cover; aspect-ratio: 4 / 3; }
.product-info { padding: 1rem; }
.title { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem; }
.weight { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 0.75rem; }
.price-container { display: flex; align-items: baseline; gap: 0.75rem; margin-bottom: 1rem; }
.current-price { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
.original-price { font-size: 1rem; color: var(--text-muted); text-decoration: line-through; }
.card-footer { display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
.add-to-cart-btn {
    background: var(--gradient-primary); color: white; border: none; width: 48px; height: 48px;
    border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem; transition: transform 0.3s; box-shadow: var(--shadow-soft);
}
.add-to-cart-btn:hover { transform: scale(1.15); }
.quantity-control { display: none; align-items: center; gap: 0.75rem; background: var(--bg-secondary); border-radius: var(--border-radius-medium); padding: 0.5rem; }
.quantity-btn { width: 32px; height: 32px; border-radius: 50%; border: none; background: var(--primary-color); color: white; cursor: pointer; font-weight: 700; transition: transform 0.3s; }
.quantity-btn:hover { transform: scale(1.1); }
.quantity { font-weight: 700; min-width: 24px; text-align: center; font-size: 1rem; }
.details-btn { background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 0.9rem; text-decoration: none; }

/* === MODAL (ВІДНОВЛЕНІ СТИЛІ) === */
.modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(139, 69, 19, 0.7);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-smooth);
    padding: 2rem;
}
.modal-backdrop.visible {
    opacity: 1;
    visibility: visible;
}
.modal-content {
    background: var(--bg-card);
    border-radius: var(--border-radius-large);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-strong);
    transform: scale(0.8) translateY(50px);
    transition: all var(--transition-bounce);
    border: 2px solid var(--border-color);
}
.modal-backdrop.visible .modal-content {
    transform: scale(1) translateY(0);
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem;
    border-bottom: 2px solid var(--border-color);
    background: var(--gradient-secondary);
}
.modal-title {
    font-family: 'Comfortaa', sans-serif;
    font-size: 1.6rem;
    font-weight: 600;
    color: var(--text-primary);
}
.modal-close {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--bg-tertiary);
    color: var(--text-secondary);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.6rem;
    transition: all var(--transition-bounce);
    box-shadow: var(--shadow-soft);
}
.modal-close:hover {
    background: var(--error-color);
    color: white;
    transform: scale(1.15) rotate(90deg);
}
.modal-body {
    padding: 2rem;
    line-height: 1.7;
    color: var(--text-secondary);
    font-size: 1.05rem;
}

/* === ORDER FORM === */
.order-form {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--bg-card);
    border-top-left-radius: var(--border-radius-large);
    border-top-right-radius: var(--border-radius-large);
    max-height: 90vh; overflow-y: auto; z-index: 1500;
    transform: translateY(100%);
    transition: transform var(--transition-smooth);
    box-shadow: 0 -10px 40px rgba(212, 147, 90, 0.3);
    border-top: 3px solid var(--primary-color);
}
.order-form.visible { transform: translateY(0); }
.order-form-content { padding: 1.5rem; position: relative; }
.order-form-close-btn {
    position: absolute; top: 1rem; right: 1rem;
    width: 40px; height: 40px; border-radius: 50%; border: none;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    font-size: 1.4rem; background: var(--bg-tertiary); color: var(--text-primary);
    transition: all var(--transition-bounce); z-index: 10;
}
.order-form-close-btn:hover { background: var(--error-color); color: white; transform: rotate(90deg); }
.order-form h2 { font-size: 1.4rem; font-weight: 600; margin-bottom: 1rem; }
.change-order-btn {
    background: var(--bg-tertiary); color: var(--text-secondary); border: none;
    padding: 0.6rem 1rem; border-radius: var(--border-radius-medium);
    cursor: pointer; margin-bottom: 1rem; transition: all var(--transition-smooth); font-weight: 600;
}
.change-order-btn:hover { background: var(--primary-color); color: white; }
.summary-item { display: flex; align-items: center; gap: 1rem; padding: 0.8rem; background: var(--bg-secondary); border-radius: var(--border-radius-medium); margin-bottom: 0.8rem; }
.summary-item-img { width: 60px; height: 60px; border-radius: var(--border-radius-medium); object-fit: cover; }
.summary-item-details { flex: 1; }
.summary-item-name { font-weight: 600; margin-bottom: 0.25rem; font-size: 0.95rem; }
.summary-item-quantity { color: var(--text-muted); font-size: 0.85rem; }
.summary-item-price { font-weight: 700; color: var(--primary-color); }
.summary-totals { background: var(--bg-secondary); border-radius: var(--border-radius-large); padding: 1rem; margin: 1.5rem 0; }
.summary-totals>div { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
.total-price { font-weight: 700; font-size: 1.2rem; color: var(--primary-color); border-top: 1px solid var(--border-color); padding-top: 0.8rem; margin-top: 0.8rem; }
.total-discount { color: var(--success-color); font-weight: 600; }
.delivery-options { margin-bottom: 1.5rem; }
.delivery-option { display: flex; align-items: center; padding: 1rem; border: 2px solid var(--border-color); border-radius: var(--border-radius-medium); margin-bottom: 0.8rem; cursor: pointer; }
.delivery-option:hover { border-color: var(--primary-color); }
.delivery-option input[type="radio"] { margin-right: 1rem; transform: scale(1.2); accent-color: var(--primary-color); }
.delivery-option label { flex: 1; cursor: pointer; }
.delivery-option .price { font-weight: 700; color: var(--primary-color); }
.address-field { margin-bottom: 1rem; opacity: 0; max-height: 0; overflow: hidden; transition: all var(--transition-smooth); }
.address-field.visible { opacity: 1; max-height: 100px; }
.form-group { margin-bottom: 1rem; }
.form-group input, .address-field input {
    width: 100%; padding: 1rem; border: 2px solid var(--border-color);
    border-radius: var(--border-radius-medium); font-size: 1rem;
    background: var(--bg-primary); color: var(--text-primary); transition: all var(--transition-smooth);
}
.form-group input:focus, .address-field input:focus { outline: none; border-color: var(--primary-color); }
.error { color: var(--error-color); font-size: 0.9rem; margin-bottom: 1rem; text-align: center; }
.order-notice { background: rgba(212, 147, 90, 0.1); border-radius: var(--border-radius-medium); padding: 1rem; margin-bottom: 1rem; font-size: 0.9rem; display: flex; align-items: center; gap: 0.8rem; }
.order-notice i { color: var(--primary-color); }

/* === INFO SECTIONS === */
.info-section { padding: 2rem 0; margin-top: 2rem; }
.section-title { text-align: center; font-size: 1.8rem; font-weight: 700; margin-bottom: 2rem; color: var(--text-primary); }
.about-content { display: grid; grid-template-columns: 1fr; gap: 2rem; text-align: center; }
.about-image img { width: 100%; border-radius: var(--border-radius-large); box-shadow: var(--shadow-medium); }
.about-text h3 { font-size: 1.5rem; margin-bottom: 1rem; }
.about-text p { color: var(--text-secondary); line-height: 1.7; font-size: 1rem; }
.reviews-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
.review-card { background: var(--bg-card); padding: 1.5rem; border-radius: var(--border-radius-large); box-shadow: var(--shadow-soft); border: 1px solid var(--border-color); }
.review-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
.review-header .fa-user-circle { font-size: 3rem; color: var(--primary-color); }
.reviewer-name { font-weight: 600; font-size: 1.1rem; }
.review-stars { color: #F39C12; font-size: 1rem; }
.review-text { color: var(--text-secondary); font-style: italic; font-size: 1rem; }

/* === АДАПТИВНІСТЬ (TABLET & DESKTOP) === */
@media (min-width: 600px) {
    .product-list { grid-template-columns: repeat(2, 1fr); }
    .reviews-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (min-width: 768px) {
    :root { font-size: 16px; }
    .header { padding: 1rem 0; }
    .header-content { gap: 1.5rem; padding: 0 1.5rem; }
    .search-input { padding: 1rem 1rem 1rem 3.5rem; }
    .search-icon { display: block; position: absolute; left: 1.2rem; top: 50%; transform: translateY(-50%); color: var(--primary-color); font-size: 1.2rem; }
    .container { padding: 0 1.5rem 3rem; }
    .product-list { margin-top: 2rem; }
    .product-info { padding: 1.5rem; }
    .section-title { font-size: 2.2rem; }
    .about-content { grid-template-columns: 1fr 1.5fr; text-align: left; }
}
@media (min-width: 1024px) {
    .product-list { grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem; }
    .reviews-grid { grid-template-columns: repeat(3, 1fr); }
}
</style>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
  <header class="header">
    <div class="header-content">
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="Пошук сирів..." id="search-input">
        </div>
        <div class="header-actions">
            <button class="cart-badge" id="cart-badge" title="Кошик">
                <span class="cart-count hidden" id="cart-count">0</span>
                <i class="fas fa-shopping-cart"></i>
            </button>
        </div>
    </div>
</header>

<section class="promo-section" id="promo-section">
  <div class="container">
    <div class="promo-box">
      🎉 Лише зараз! <strong>-15%</strong> на всі сири 🧀  
      <span class="promo-sub">Встигніть замовити до кінця тижня!</span>
      <button class="promo-close" id="promo-close">×</button>
    </div>
  </div>
</section>

<div class="container">
    <div class="loading" id="loading">
        <div class="spinner"></div>
        Завантаження каталогу...
    </div>
    <div class="product-list" id="product-list"></div>
</div>

<section id="reviews" class="info-section">
    <div class="container">
        <h2 class="section-title">Відгуки наших клієнтів</h2>
        <div class="reviews-grid">
            <div class="review-card">
                <div class="review-header">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <p class="reviewer-name">Олена П.</p>
                        <div class="review-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i></div>
                    </div>
                </div>
                <p class="review-text">"Неймовірно смачний сир! Гауда просто тане в роті. Відчувається, що продукт натуральний і зроблений з душею. Обов'язково замовлю ще!"</p>
            </div>
            <div class="review-card">
                <div class="review-header">
                    <i class="fas fa-user-circle"></i>
                    <div>
                        <p class="reviewer-name">Андрій</p>
                        <div class="review-stars"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i></div>
                    </div>
                </div>
                <p class="review-text">"Замовляв доставку по Обухову, все привезли швидко. Сир свіжий, ароматний. Трохи дорожче, ніж в магазині, але якість того варта."</p>
            </div>
        </div>
    </div>
</section>

<section id="about-us" class="info-section">
    <div class="container">
        <h2 class="section-title">Про Нас</h2>
        <div class="about-content">
            <div class="about-image">
                <img src="data/pro_nas.png" alt="Наша сироварня">
            </div>
            <div class="about-text">
                <h3>Сімейна справа з любов'ю до сиру</h3>
                <p><strong>Family Cheese</strong> — це невелика сімейна сироварня, де ми створюємо натуральні сири за традиційними рецептами. Кожна головка сиру — це результат ручної праці, якісного молока та нашої пристрасті до сироваріння.</p>
            </div>
        </div>
    </div>
</section>

<div class="modal-backdrop" id="description-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 class="modal-title" id="modal-title"></h2>
            <button class="modal-close" id="modal-close-btn"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="modal-body"></div>
    </div>
</div>

<div id="order-form" class="order-form">
    <div class="order-form-content">
        <button class="order-form-close-btn" id="order-form-close-btn" title="Закрити"><i class="fas fa-times"></i></button>
        <h2>Ваше замовлення</h2>
        <div id="order-summary"></div>
        <button class="change-order-btn"><i class="fas fa-edit"></i> Змінити замовлення</button>
        <div class="delivery-options">
            <h2>Спосіб доставки</h2>
            <div class="delivery-option">
                <input type="radio" id="obukhiv-delivery" name="delivery" value="50" data-title="Доставка по м. Обухів" checked>
                <label for="obukhiv-delivery"><b>Доставка по м. Обухів</b></label>
                <span class="price">50 грн</span>
            </div>
            <div class="delivery-option">
                <input type="radio" id="obukhiv-nova-poshta" name="delivery" value="50" data-title="Доставка Нова пошта м. Обухів">
                <label for="obukhiv-nova-poshta"><b>Доставка у відділення «Нова пошта»</b><br>або поштомат у м. Обухів</label>
                <span class="price">50 грн</span>
            </div>
            <div class="delivery-option">
                <input type="radio" id="nova-poshta" name="delivery" value="0" data-title="Нова Пошта">
                <label for="nova-poshta"><b>«Нова пошта»</b><br>За тарифами перевізника</label>
            </div>
        </div>
        <div id="address-field-container" class="address-field visible">
            <input type="text" id="address-input" placeholder="Введіть вашу адресу або № відділення">
        </div>
        <h2>Контактні дані</h2>
        <p class="error" id="form-error"></p>
        <div class="form-group">
            <input type="text" id="user-name" placeholder="Ім'я та Прізвище">
        </div>
        <div class="form-group">
            <input type="tel" id="user-phone" placeholder="0 XX XXX XX XX">
        </div>
        <div class="order-notice"><i class="fas fa-info-circle"></i> Фінальна сума може змінитися після зважування.</div>
        <div class="order-notice"><i class="fas fa-credit-card"></i> Оплата після отримання замовлення.</div>
    </div>
</div>

<script type="module">
    const MOCK_PRODUCTS_DATA = [
        { "id": "Гауда50", "name": "Сир твердий «Гауда» 50%", "price": 163.2, "original_price": 192, "is_hit": false, "description": "Твердий сир з м'яким кремовим смаком, виготовлений зі справжнього коров’ячого молока та закваски. Сир містить вітаміни A, B, C, D,E, K, насичує організм селеном, залізом, цинком, йодом, кальцієм та калієм. Особливо корисно вживати цей сир на сніданок!", "weight": "ваккум, ~400 г", "images": ["data/gauda.jpg"] },
        { "id": "Рікотта", "name": "Сир м'який «Рікотта»", "price": 89.25, "original_price": 105, "is_hit": false, "description": "Солодкуватий на смак за рахунок лактози, що входить до його складу. Це - король серед всіх білкових молочних продуктів. Рікотта, вагою 400 грамів містить до 96 грамів білка. Мало жиру і багато білка - ідеальний продукт для людей, які вирішили «сісти» на дієту з метою схуднення.", "weight": "ваккум, ~500 г", "images": ["data/ricotta.jpeg"] },
        { "id": "Масло", "name": "Масло «Домашнє»", "price": 183.6, "original_price": 216, "is_hit": false, "description": "Вершки збиті в маслобійці! В першу чергу відповідає за гладку шкіру, гарне волосся і міцні нігті, а все тому, що в ньому містяться жиророзчинні вітаміни А, D, E, K.", "weight": "пак, ~400 г", "images": ["data/maslo.jpeg"] },
        { "id": "Моцарелла", "name": "Сир «Моцарелла»", "price": 111.5625, "original_price": 131.25, "is_hit": false, "description": "Класичний італійський м’який розсільний сир. Смакує в салатах, закусках, відмінно плавиться. Дуже ніжний та корисний!", "weight": "ваккум, ~350 г", "images": ["data/mocarella.jpeg"] },
        { "id": "Фета", "name": "Сир «Фета»", "price": 55.8875, "original_price": 65.75, "is_hit": false, "description": "Фета, Фетакі — популярний грецький сир. Слово «фета» італійського походження і означає «скибка ». Фета належить до групи м'яких сирів, його жирність становить 8%.", "weight": "ваккум, ~250 г", "images": ["data/feta.jpeg"] },
        { "id": "Гауда35", "name": "Сир твердий «Гауда» 35%", "price": 158.1, "original_price": 186, "is_hit": false, "description": "Твердий сир з м'яким кремовим смаком, виготовлений зі справжнього коров’ячого молока та закваски. Сир містить вітаміни A, B, C, D,E, K, насичує організм селеном, залізом, цинком, йодом, кальцієм та калієм. Особливо корисно вживати цей сир на сніданок!", "weight": "ваккум, ~400 г", "images": ["data/gauda35.jpg"] },
        { "id": "Чеддер", "name": "Сир твердий «Чеддер»", "price": 178.5, "original_price": 210, "is_hit": false, "description": "Цей популярний англійський сир відрізняється однорідною текстурою, маслянистої, що кришиться і злегка мажущейся консистенцією, а також багатим сирним смаком. Для його виробництва використовується натуральне коров`яче молоко. Період дозрівання зазвичай становить від 3 місяців. Чеддер прекрасно підходить для приготування гарнірів, салатів і закусок.", "weight": "ваккум, ~400 г", "images": ["data/chedder.jpeg"] },
        { "id": "Плавлений", "name": "Сир плавлений", "price": 53.55, "original_price": 63, "is_hit": false, "description": "Що може бути приємніше і ситніше вранці, ніж  плавлений сир? Він прекрасно наноситься на хліб і відмінно втамовує голод. Він сподобається дорослим і дітям. Це дуже ніжний вершковий продукт. Плавлений сир - відмінний початок дня для всієї родини.", "weight": "банк, ~1 000 г", "images": ["data/plavleny.jpg"] },
        { "id": "Вершки", "name": "Вершки", "price": 119, "original_price": 140, "is_hit": false, "description": "Мають жирність 25-30%. Вони відмінно поєднуються з кавою, надаючи їй особливо ніжного і м`якого смаку.Вершки можна використовувати для приготування смачних десертів і домашнього морозива.", "weight": "пляш, 1 шт", "images": ["data/slivki.jpg"] },
        { "id": "Адигейський", "name": "Сир м'який «Адигейський»", "price": 161.2875, "original_price": 189.75, "is_hit": false, "description": "Сир Адигейський — м'який сир традиційний для передгір'я та гірських районів Кавказу. \nМи виготовляємо його з відбірного фермерського молока. Має ніжний вершковий смак.\nЖирність 40%.\n☝️При виробництві продукції для збереження корисних властивостей молока ми використовуємо лагідну пастерізація при температурі 65~67°C.\n☺️Використання :\n✔️для додавання у салати\n✔️для бутербродів\n✔️ і просто до чаю чи кави☕", "weight": "ваккум, ~550 г", "images": ["data/adygeyskiy.jpg"] },
        { "id": "Блек", "name": "Сир твердий «Black edition»", "price": 187.425, "original_price": 220.5, "is_hit": false, "description": "Black Edition, жирністю 50%, термін дозрівання 50 днів. Має легкий аромат тропічних фруктів, завдяки доданому кокосовому вугіллю. Трендовий сир для подарунку чи святкового столу.", "weight": "ваккум, ~350 г", "images": ["data/black.jpg"] },
        { "id": "Бринза", "name": "Бринза", "price": 143.4375, "original_price": 168.75, "is_hit": false, "description": "Бринза - молодий розсільний сир жирністю 35%. У складі тільки відбірне молоко, закваска та сіль. \nМінімально просто, максимально корисно.\nСмакує з літніми салатами чи просто як корисний поживний перекус.", "weight": "ваккум, ~450 г", "images": ["data/brynza.jpg"] },
        { "id": "ГаудаПажитником", "name": "«Гауда» 50% з пажитником", "price": 168.3, "original_price": 198, "is_hit": false, "description": "Пажитник (він же шамбала, хельба, фенугрек) - однорічна трава із сімейства бобових. Насіння, яке ми додаємо до нашого сиру Гауда, має солодкуватий горіховий присмак і додає сиру не тільки приємний смак, а й додаткову користь.", "weight": "ваккум, ~400 г", "images": ["data/pagytnik.jpg"] },
        { "id": "Лабне", "name": "Лабне", "price": 114.75, "original_price": 135, "is_hit": false, "description": "Лабне - молодий розсільний сир, з травами та часником у оливковій олії. Виготовляється з йогурту. Має ніжний, вершковий смак та легкий аромат часнику. Ідеально для додавання у салати та як намазка на тости. Жирність 40%.", "weight": "банк, 1 шт", "images": ["data/labne.jpg"] },
        { "id": "МаслоШоколадне", "name": "Масло шоколадне", "price": 182.9625, "original_price": 215.25, "is_hit": false, "description": "Шоколадне масло TM Family cheese занурить вас у дитинство. Неймовірно смачне, з натуральних вершків з додаванням високоякісного какао-порошку. Ідеальна для бутербродів, кремів чи десертів.", "weight": "пак, ~350 г", "images": ["data/masloshokolad.jpg"] },
        { "id": "ПестоЗеленеЧервоне", "name": "Сир твердий «Песто»", "price": 187.18, "original_price": 220.5, "is_hit": false, "description": "Песто з італійськими травами. Жирність 50%. Витримка 50 днів. Смак витончений та злегка освіжаючий, завдяки доданому сушеному базиліку.", "weight": "ваккум, ~350 г", "images": ["data/pesto.jpg"] },
        { "id": "Халумі", "name": "Халумі", "price": 95.625, "original_price": 112.5, "is_hit": false, "description": "Халумі - сир для смаження чи приготування на грилі. Має високу температуру плавлення, завдяки чому може бути обсмажений до золотавої скоринки, залишаючись ніжним всередині. Гарно поєднується з овочами, відмінно смакує в салатах або як окрема страва-гриль.", "weight": "ваккум, ~300 г", "images": ["data/halumi.jpg"] }
    ];

    const AppState = {
        products: [],
        cart: {},
        isFormVisible: false,
        tg: null,
    };

    const elements = {
        loading: document.getElementById('loading'),
        productList: document.getElementById('product-list'),
        searchInput: document.getElementById('search-input'),
        cartBadge: document.getElementById('cart-badge'),
        cartCount: document.getElementById('cart-count'),
        promoSection: document.getElementById('promo-section'),
        promoCloseBtn: document.getElementById('promo-close'),
        orderForm: document.getElementById('order-form'),
        orderFormCloseBtn: document.getElementById('order-form-close-btn'),
        changeOrderBtn: document.querySelector('.change-order-btn'),
        deliveryOptions: document.querySelectorAll('input[name="delivery"]'),
        addressContainer: document.getElementById('address-field-container'),
        orderSummary: document.getElementById('order-summary'),
        userNameInput: document.getElementById("user-name"),
        userPhoneInput: document.getElementById("user-phone"),
        addressInput: document.getElementById("address-input"),
        formError: document.getElementById("form-error"),
        modal: document.getElementById('description-modal'),
        modalTitle: document.getElementById('modal-title'),
        modalBody: document.getElementById('modal-body'),
        modalCloseBtn: document.getElementById('modal-close-btn'),
    };

    function createProductElement(product) {
        const card = document.createElement("div");
        card.className = "product-card";
        card.dataset.id = product.id;
        const priceHTML = product.original_price
            ? `<span class="current-price">${product.price.toFixed(2)} грн</span><span class="original-price">${product.original_price.toFixed(2)} грн</span>`
            : `<span class="current-price">${product.price.toFixed(2)} грн</span>`;
        card.innerHTML = `
            <div class="gallery"><img src="${product.images[0]}" alt="${product.name}" class="gallery-image" onerror="this.onerror=null;this.src='https://placehold.co/400x300/F0E6D6/8B4513?text=Family+Cheese';"></div>
            <div class="product-info">
                <h3 class="title">${product.name}</h3>
                <div class="weight"><i class="fas fa-balance-scale"></i> ${product.weight}</div>
                <div class="price-container">${priceHTML}</div>
                <div class="card-footer">
                    <button class="add-to-cart-btn" title="Додати в кошик"><i class="fas fa-plus"></i></button>
                    <div class="quantity-control">
                        <button class="quantity-btn" data-action="decrease"><i class="fas fa-minus"></i></button>
                        <span class="quantity">1</span>
                        <button class="quantity-btn" data-action="increase"><i class="fas fa-plus"></i></button>
                    </div>
                    <button class="details-btn" data-title="${product.name}" data-description="${product.description.replace(/"/g, '&quot;')}">
                        <i class="fas fa-info-circle"></i> Детальніше
                    </button>
                </div>
            </div>`;
        return card;
    }

    // --- Cart Logic ---
    function updateCart(productId, action) {
        const product = AppState.products.find(p => p.id == productId);
        if (!product) return;
        if (action === 'add' && !AppState.cart[productId]) {
            AppState.cart[productId] = { name: product.name, price: product.price, quantity: 1 };
        } else if (action === 'increase' && AppState.cart[productId]) {
            AppState.cart[productId].quantity++;
        } else if (action === 'decrease' && AppState.cart[productId]) {
            AppState.cart[productId].quantity--;
            if (AppState.cart[productId].quantity <= 0) {
                delete AppState.cart[productId];
            }
        }
        // ВИДАЛЕНО updateUI() ЩОБ УНИКНУТИ ПОВНОГО ПЕРЕМАЛЬОВУВАННЯ
    }

    // --- Order Form Logic ---
    function openOrderForm() {
        AppState.isFormVisible = true;
        renderOrderSummary();
        elements.orderForm.classList.add("visible");
        AppState.tg?.BackButton.show();
        updateMainButton();
    }

    function closeOrderForm() {
        AppState.isFormVisible = false;
        elements.orderForm.classList.remove("visible");
        AppState.tg?.BackButton.hide();
        updateMainButton();
    }

    function renderOrderSummary() {
        let itemsHTML = "", productsTotal = 0, totalDiscount = 0;
        for (const id in AppState.cart) {
            const product = AppState.products.find(p => p.id == id);
            const item = AppState.cart[id];
            if (!product) continue;
            const itemTotalPrice = item.price * item.quantity;
            productsTotal += itemTotalPrice;
            if (product.original_price) totalDiscount += (product.original_price - item.price) * item.quantity;
            itemsHTML += `<div class="summary-item"><img src="${product.images[0]}" alt="${item.name}" class="summary-item-img" onerror="this.onerror=null;this.src='https://placehold.co/64x64/F0E6D6/8B4513?text=🧀';"><div class="summary-item-details"><div class="summary-item-name">${item.name}</div><div class="summary-item-quantity">${item.quantity} x ${item.price.toFixed(2)} грн</div></div><div class="summary-item-price">${itemTotalPrice.toFixed(2)} грн</div></div>`;
        }
        const selectedDelivery = document.querySelector('input[name="delivery"]:checked');
        const deliveryCost = parseInt(selectedDelivery?.value || "0", 10);
        const finalTotal = productsTotal + deliveryCost;
        const totalsHTML = `<div class="summary-totals">${totalDiscount > 0 ? `<div class="total-discount"><span><i class="fas fa-tags"></i> Ваша знижка:</span><span>-${totalDiscount.toFixed(2)} грн</span></div>` : ""}${deliveryCost > 0 ? `<div><span><i class="fas fa-truck"></i> Доставка:</span><span>${deliveryCost.toFixed(2)} грн</span></div>` : ""}<div class="total-price"><span><i class="fas fa-receipt"></i> Всього:</span><span>${finalTotal.toFixed(2)} грн</span></div></div>`;
        elements.orderSummary.innerHTML = itemsHTML + totalsHTML;
    }

    // --- Services ---
    function initializeTelegramWebApp() {
        try {
            AppState.tg = window.Telegram?.WebApp;
            if (AppState.tg) {
                AppState.tg.ready();
                AppState.tg.expand();
            }
        } catch (e) { console.warn(`Error initializing Telegram WebApp: ${e.message}`); }
    }

    async function loadProducts() {
        elements.loading.style.display = 'flex';
        try {
            // Тут може бути fetch, але для простоти використовуємо вбудовані дані
            AppState.products = MOCK_PRODUCTS_DATA;
        } catch (error) {
            console.error('Failed to load products:', error);
        } finally {
            elements.loading.style.display = 'none';
        }
    }
    
    function submitOrder() {
        // Тут буде логіка валідації та відправки
        AppState.tg?.showAlert('Ваше замовлення прийнято! Очікуйте на повідомлення в telegram.');
        AppState.tg?.close();
    }

    // --- UI Management ---
    function renderProducts() {
        const query = elements.searchInput.value.toLowerCase();
        const filteredProducts = AppState.products.filter(p =>
            p.name.toLowerCase().includes(query) || p.description.toLowerCase().includes(query)
        );
        elements.productList.innerHTML = "";
        if (filteredProducts.length === 0) {
            elements.productList.innerHTML = `<div style="text-align: center; padding: 2rem;"><h3>Товари не знайдено</h3></div>`;
            return;
        }
        filteredProducts.forEach(product => {
            elements.productList.appendChild(createProductElement(product));
        });
    }

    function updateMainButton() {
        const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);
        if (totalItems > 0) {
            const buttonText = AppState.isFormVisible ? 'Надіслати замовлення' : `Кошик (${totalItems})`;
            AppState.tg?.MainButton.setText(buttonText);
            AppState.tg?.MainButton.setParams({ color: '#D4935A', text_color: '#FFFFFF' });
            AppState.tg?.MainButton.show();
        } else {
            AppState.tg?.MainButton.hide();
            if (AppState.isFormVisible) closeOrderForm();
        }
    }
    
    // 🔥 НОВА ФУНКЦІЯ: Оновлює лише одну картку товару
    function updateSingleCardUI(cardElement) {
        const id = cardElement.dataset.id;
        const addBtn = cardElement.querySelector('.add-to-cart-btn');
        const quantityControl = cardElement.querySelector('.quantity-control');
        
        if (AppState.cart[id]) {
            addBtn.style.display = 'none';
            quantityControl.style.display = 'flex';
            quantityControl.querySelector('.quantity').textContent = AppState.cart[id].quantity;
        } else {
            addBtn.style.display = 'flex';
            quantityControl.style.display = 'none';
        }
    }

    function updateUI() {
        renderProducts();
        // Після повного рендеру (наприклад, після пошуку) оновлюємо стан кнопок на всіх картках
        document.querySelectorAll('.product-card').forEach(card => updateSingleCardUI(card));
        
        const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);
        elements.cartCount.textContent = totalItems;
        elements.cartCount.classList.toggle('hidden', totalItems === 0);
        
        updateMainButton();
    }

    function showProductDetailsModal(title, description) {
        elements.modalTitle.textContent = title;
        elements.modalBody.innerHTML = description.replace(/\n/g, '<br><br>');
        elements.modal.classList.add('visible');
        AppState.tg?.BackButton.show();
    }

    function closeProductDetailsModal() {
        elements.modal.classList.remove('visible');
        if (!AppState.isFormVisible) AppState.tg?.BackButton.hide();
    }

    // --- Event Handlers ---
    // 🔥 ОНОВЛЕНИЙ ОБРОБНИК: Вирішує всі проблеми
    function handleProductClick(e) {
        const card = e.target.closest('.product-card');
        if (!card) return;

        const productId = card.dataset.id;
        let cartActionOccurred = false;

        if (e.target.closest('.add-to-cart-btn')) {
            updateCart(productId, 'add');
            cartActionOccurred = true;
        } else if (e.target.closest('.quantity-btn')) {
            const action = e.target.closest('.quantity-btn').dataset.action;
            updateCart(productId, action);
            cartActionOccurred = true;
        } else if (e.target.closest('.details-btn')) {
            const detailsBtn = e.target.closest('.details-btn');
            showProductDetailsModal(detailsBtn.dataset.title, detailsBtn.dataset.description);
        }

        if (cartActionOccurred) {
            updateSingleCardUI(card); // Оновлюємо лише одну картку
            // Оновлюємо загальні елементи
            const totalItems = Object.values(AppState.cart).reduce((sum, item) => sum + item.quantity, 0);
            elements.cartCount.textContent = totalItems;
            elements.cartCount.classList.toggle('hidden', totalItems === 0);
            updateMainButton();
        }
    }
    
    function closePromo() {
        elements.promoSection.style.transition = 'opacity 0.4s, transform 0.4s';
        elements.promoSection.style.opacity = '0';
        elements.promoSection.style.transform = 'scale(0.95)';
        setTimeout(() => elements.promoSection.style.display = "none", 400);
    }
    
    function initEventListeners() {
        elements.cartBadge.addEventListener('click', () => {
            if (Object.keys(AppState.cart).length > 0) openOrderForm();
        });
        elements.changeOrderBtn?.addEventListener('click', closeOrderForm);
        elements.orderFormCloseBtn?.addEventListener('click', closeOrderForm);
        elements.searchInput.addEventListener('input', updateUI);
        elements.productList.addEventListener('click', handleProductClick);
        elements.deliveryOptions.forEach(option => option.addEventListener('change', renderOrderSummary));
        elements.modalCloseBtn.addEventListener('click', closeProductDetailsModal);
        elements.modal.addEventListener('click', e => { if (e.target === elements.modal) closeProductDetailsModal(); });
        elements.promoCloseBtn.addEventListener('click', closePromo);

        if (AppState.tg) {
            AppState.tg.onEvent('backButtonClicked', () => {
                if (elements.modal.classList.contains('visible')) closeProductDetailsModal();
                else if (AppState.isFormVisible) closeOrderForm();
            });
            AppState.tg.onEvent('mainButtonClicked', () => {
                if (!AppState.isFormVisible) openOrderForm();
                else submitOrder();
            });
        }
    }

    function initApp() {
        initializeTelegramWebApp();
        initEventListeners();
        loadProducts().then(updateUI);
    }

    document.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>